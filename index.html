<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Lucky Bonanza</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800;900&display=swap');
:root{--bg:#0a0a14;--card:#151525;--card2:#1a1a30;--accent:#c8ff2e;--pink:#ff3d8a;--gold:#ffd700;--blue:#4d7cff;--text:#e8e8f0;--dim:#6b6b8d;--green:#00e676;--red:#ff4444;--nav:#0d0d1a;--radius:16px}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
body{background:var(--bg);color:var(--text);font-family:'Outfit',sans-serif;min-height:100vh;overflow-x:hidden;padding-bottom:70px}
::-webkit-scrollbar{display:none}

/* === SCREENS === */
.screen{display:none;opacity:0;transition:opacity .2s}.screen.active{display:block;opacity:1}

/* === TOP BAR === */
.topbar{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;position:sticky;top:0;z-index:50;background:var(--bg)}
.topbar-logo{font-weight:900;font-size:20px;background:linear-gradient(135deg,var(--accent),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.topbar-balance{display:flex;align-items:center;gap:6px;background:var(--card);border:1px solid rgba(200,255,46,.2);border-radius:30px;padding:6px 14px 6px 10px;font-weight:700;font-size:14px;color:var(--accent);cursor:pointer}
.topbar-balance .coin-icon{width:18px;height:18px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;color:#000;font-weight:900}

/* === PROMO BANNER === */
.promo-banner{margin:0 16px 12px;border-radius:var(--radius);background:linear-gradient(135deg,#1a0a3e,#3d1266 50%,#0a2a5e);padding:20px;position:relative;overflow:hidden;min-height:100px}
.promo-banner::after{content:'';position:absolute;top:-50%;right:-30%;width:200px;height:200px;background:radial-gradient(circle,rgba(200,255,46,.15),transparent 70%);border-radius:50%}
.promo-tag{font-size:10px;font-weight:700;text-transform:uppercase;color:var(--accent);letter-spacing:2px;margin-bottom:6px}
.promo-title{font-size:22px;font-weight:900;line-height:1.2;margin-bottom:4px}
.promo-sub{font-size:12px;color:var(--dim)}

/* === WHEEL BANNER === */
.wheel-banner{margin:0 16px 12px;border-radius:var(--radius);background:linear-gradient(135deg,#1a2a0a,#0a3a1a);border:1px solid rgba(0,230,118,.2);padding:14px 16px;display:flex;align-items:center;gap:12px;cursor:pointer;transition:transform .15s}
.wheel-banner:active{transform:scale(.97)}
.wheel-icon{font-size:36px;animation:wheel-rotate 3s linear infinite}
@keyframes wheel-rotate{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
.wheel-banner.done{opacity:.5;pointer-events:none}
.wheel-banner.done .wheel-icon{animation:none}
.wheel-info h3{font-size:14px;font-weight:700;color:var(--green)}.wheel-info p{font-size:11px;color:var(--dim)}

/* === SECTION === */
.section{padding:0 16px;margin-bottom:16px}
.section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.section-title{font-size:14px;font-weight:800;text-transform:uppercase;letter-spacing:1px;color:var(--dim)}
.section-more{font-size:11px;color:var(--accent);cursor:pointer}

/* === GAME CARDS === */
.games-row{display:flex;gap:10px;overflow-x:auto;padding-bottom:6px;scroll-snap-type:x mandatory}
.game-card{min-width:130px;border-radius:var(--radius);overflow:hidden;background:var(--card);cursor:pointer;transition:transform .15s;scroll-snap-align:start;flex-shrink:0}
.game-card:active{transform:scale(.95)}
.game-card-img{width:130px;height:130px;display:flex;align-items:center;justify-content:center;font-size:48px;position:relative}
.game-card-img.slots-bg{background:linear-gradient(135deg,#2d0060,#0d001f)}
.game-card-img.coming-bg{background:linear-gradient(135deg,#1a1a30,#0a0a20)}
.game-card-info{padding:8px 10px}
.game-card-name{font-size:12px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.game-card-tag{font-size:9px;color:var(--accent);font-weight:600;text-transform:uppercase;margin-top:2px}
.game-card .coming-label{position:absolute;bottom:8px;left:8px;right:8px;background:rgba(0,0,0,.7);border-radius:8px;padding:4px;text-align:center;font-size:9px;font-weight:700;color:var(--dim)}

/* === VIP CARD === */
.vip-card{margin:0 16px 16px;border-radius:var(--radius);background:var(--card);padding:16px;display:flex;align-items:center;gap:14px}
.vip-icon{font-size:36px}
.vip-info{flex:1}
.vip-name{font-size:14px;font-weight:800}.vip-cb{font-size:11px;color:var(--dim)}
.vip-bar{height:4px;background:rgba(255,255,255,.1);border-radius:2px;margin-top:6px;overflow:hidden}
.vip-bar-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--pink));border-radius:2px;transition:width .5s}

/* === BOTTOM NAV === */
.bottom-nav{position:fixed;bottom:0;left:0;right:0;height:64px;background:var(--nav);border-top:1px solid rgba(255,255,255,.06);display:flex;z-index:100;padding-bottom:env(safe-area-inset-bottom)}
.nav-item{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;cursor:pointer;color:var(--dim);transition:color .2s;position:relative}
.nav-item.active{color:var(--accent)}
.nav-item .nav-icon{font-size:20px;line-height:1}.nav-item .nav-label{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.5px}
.nav-item .nav-dot{position:absolute;top:6px;right:calc(50% - 16px);width:6px;height:6px;background:var(--pink);border-radius:50%;display:none}
.nav-item .nav-dot.show{display:block}

/* === GAME SCREEN === */
.game-topbar{display:flex;justify-content:space-between;align-items:center;padding:8px 16px}
.game-back{font-size:24px;cursor:pointer;padding:4px 8px}
.game-balance{font-weight:700;color:var(--accent);font-size:14px}
.game-area{padding:0 10px}
.grid-frame{background:rgba(0,0,0,.5);border:2px solid rgba(200,255,46,.1);border-radius:var(--radius);padding:6px;position:relative;overflow:hidden}
.grid-frame.bonus-mode{border-color:var(--pink);box-shadow:0 0 30px rgba(255,61,138,.2)}
.grid{display:grid;grid-template-columns:repeat(6,1fr);gap:3px}
.cell{aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-size:22px;border-radius:8px;background:rgba(255,255,255,.04);transition:all .2s}
.cell.win{background:rgba(200,255,46,.15);transform:scale(1.08)}.cell.scatter{background:rgba(255,61,138,.2);animation:sc-p .5s infinite}
.cell.bomb{background:rgba(255,61,0,.2);animation:bm-s .3s infinite}
@keyframes sc-p{0%,100%{transform:scale(1)}50%{transform:scale(1.12)}}
@keyframes bm-s{0%,100%{transform:rotate(0)}25%{transform:rotate(-2deg)}75%{transform:rotate(2deg)}}
.game-result{text-align:center;height:28px;font-weight:800;font-size:16px;padding:4px 0}
.game-controls{display:flex;gap:8px;align-items:center;padding:0 6px}
.bet-group{flex:1;display:flex;gap:4px}
.bet-btn{flex:1;padding:10px 0;border-radius:12px;border:1.5px solid rgba(200,255,46,.15);background:transparent;color:var(--accent);font-family:'Outfit';font-weight:700;cursor:pointer;font-size:13px;transition:all .15s}
.bet-btn.on{border-color:var(--accent);background:rgba(200,255,46,.12)}
.spin-btn{width:100px;height:68px;border-radius:16px;border:none;color:#000;font-family:'Outfit';font-weight:900;cursor:pointer;font-size:14px;transition:all .2s}
.spin-btn.m-spin{background:linear-gradient(135deg,var(--accent),#a0ff00)}
.spin-btn.m-deposit{background:linear-gradient(135deg,var(--green),#00c853);color:#fff;animation:glow-g 1.5s infinite}
.spin-btn.m-load{background:var(--card);color:var(--dim)}
@keyframes glow-g{0%,100%{box-shadow:0 0 10px rgba(0,230,118,.3)}50%{box-shadow:0 0 25px rgba(0,230,118,.5)}}
.spin-btn:disabled{opacity:.4;cursor:not-allowed}
.free-spin-badge{text-align:center;padding:4px;font-size:11px;color:var(--pink);font-weight:700}
.buy-bonus{width:100%;margin-top:8px;padding:12px;border-radius:14px;border:1.5px solid rgba(255,61,138,.3);background:transparent;color:#fff;display:flex;justify-content:space-between;align-items:center;cursor:pointer;font-family:'Outfit';font-size:13px;transition:all .15s}
.buy-bonus:active{transform:scale(.97)}
.bb-left{font-weight:700}.bb-right{font-weight:800;color:var(--pink)}

/* === PROFILE SCREEN === */
.profile-header{text-align:center;padding:30px 16px 20px}
.profile-avatar{width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--pink));display:flex;align-items:center;justify-content:center;font-size:32px;margin:0 auto 10px}
.profile-name{font-size:18px;font-weight:800}.profile-vip{font-size:12px;color:var(--accent);font-weight:700}
.stat-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;padding:0 16px;margin-bottom:16px}
.stat-card{background:var(--card);border-radius:var(--radius);padding:14px;text-align:center}
.stat-val{font-size:20px;font-weight:900;color:var(--accent)}.stat-label{font-size:10px;color:var(--dim);font-weight:600;text-transform:uppercase;margin-top:2px}
.profile-actions{padding:0 16px;display:flex;flex-direction:column;gap:8px}
.profile-btn{padding:14px 16px;border-radius:var(--radius);background:var(--card);border:none;color:var(--text);display:flex;align-items:center;gap:10px;font-family:'Outfit';font-size:14px;font-weight:600;cursor:pointer;text-align:left}
.profile-btn:active{opacity:.7}
.profile-btn .pb-icon{font-size:18px}

/* === BONUS OVERLAY === */
.bonus-overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);z-index:200;display:none;flex-direction:column;align-items:center;justify-content:center;gap:12px;padding:20px}
.bonus-overlay.show{display:flex}
.bo-title{font-size:24px;font-weight:900;background:linear-gradient(135deg,var(--gold),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:bo-pop .5s ease-out}
@keyframes bo-pop{0%{transform:scale(0)}60%{transform:scale(1.2)}100%{transform:scale(1)}}
.bo-info{display:flex;gap:16px}.bo-info-item{text-align:center;background:var(--card);border-radius:12px;padding:8px 16px}
.bo-info-item .label{font-size:10px;color:var(--dim)}.bo-info-item .val{font-size:18px;font-weight:900;color:var(--gold)}
.bo-grid-wrap{width:100%;max-width:380px;background:rgba(0,0,0,.5);border:2px solid var(--pink);border-radius:var(--radius);padding:6px}
.bo-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:3px}
.bo-result{font-weight:800;font-size:18px;color:var(--green);text-align:center;min-height:24px}
.bo-total{font-size:28px;font-weight:900;color:var(--gold);text-align:center}
.bo-close{padding:12px 36px;border-radius:14px;border:none;background:linear-gradient(135deg,var(--accent),#a0ff00);color:#000;font-family:'Outfit';font-weight:900;font-size:15px;cursor:pointer;display:none}

/* Wheel overlay */
.wheel-overlay{position:fixed;inset:0;background:rgba(0,0,0,.92);z-index:200;display:none;flex-direction:column;align-items:center;justify-content:center;gap:20px;padding:20px}
.wheel-overlay.show{display:flex}
.wo-title{font-size:22px;font-weight:900;color:var(--green)}
.wo-wheel{width:200px;height:200px;border-radius:50%;border:4px solid var(--green);display:flex;align-items:center;justify-content:center;font-size:48px;transition:transform 3s cubic-bezier(.17,.67,.12,.99)}
.wo-prize{font-size:28px;font-weight:900;color:var(--accent);min-height:40px}
.wo-btn{padding:14px 40px;border-radius:14px;border:none;background:linear-gradient(135deg,var(--green),#00c853);color:#fff;font-family:'Outfit';font-weight:900;font-size:16px;cursor:pointer}

.bomb-pop{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-weight:900;font-size:44px;color:var(--red);z-index:300;pointer-events:none;animation:bp .7s ease-out forwards}
@keyframes bp{0%{transform:translate(-50%,-50%) scale(0);opacity:1}50%{transform:translate(-50%,-50%) scale(1.4);opacity:1}100%{transform:translate(-50%,-60%) scale(1);opacity:0}}
</style>
</head>
<body>

<!-- ===== SCREEN: LOBBY ===== -->
<div class="screen active" id="scrLobby">
    <div class="topbar">
        <div class="topbar-logo">Lucky Bonanza</div>
        <div class="topbar-balance" onclick="nav('deposit')"><div class="coin-icon">$</div><span id="lobbyBal">...</span></div>
    </div>
    <div class="promo-banner">
        <div class="promo-tag" id="promoTag">Welcome Bonus</div>
        <div class="promo-title" id="promoTitle">Lucky Bonanza üç≠</div>
        <div class="promo-sub" id="promoSub">Spin & win up to x100!</div>
    </div>
    <div class="wheel-banner" id="wheelBanner" onclick="openWheel()">
        <div class="wheel-icon">üé°</div>
        <div class="wheel-info"><h3 id="wheelTitle">Daily Wheel</h3><p id="wheelSub">Spin for free coins!</p></div>
    </div>
    <div class="vip-card" id="vipCard">
        <div class="vip-icon" id="vipIcon">ü•â</div>
        <div class="vip-info">
            <div class="vip-name" id="vipName">Bronze</div>
            <div class="vip-cb" id="vipCb">1% cashback</div>
            <div class="vip-bar"><div class="vip-bar-fill" id="vipBar" style="width:0%"></div></div>
        </div>
    </div>
    <div class="section">
        <div class="section-header"><div class="section-title" id="secGames">Games</div></div>
        <div class="games-row" id="gamesRow"></div>
    </div>
    <div class="section">
        <div class="section-header"><div class="section-title" id="secComing">Coming Soon</div></div>
        <div class="games-row" id="comingRow"></div>
    </div>
</div>

<!-- ===== SCREEN: GAME ===== -->
<div class="screen" id="scrGame">
    <div class="game-topbar">
        <div class="game-back" onclick="nav('lobby')">‚Üê</div>
        <div style="font-weight:800;font-size:16px">üç≠ Lucky Bonanza</div>
        <div class="game-balance">ü™ô <span id="gameBal">0</span></div>
    </div>
    <div class="game-area">
        <div class="grid-frame" id="gridFrame"><div class="grid" id="grid"></div></div>
        <div class="game-result" id="gameResult"></div>
        <div class="free-spin-badge" id="freeBadge"></div>
        <div class="game-controls">
            <div class="bet-group">
                <button class="bet-btn on" onclick="setBet(5)">5</button>
                <button class="bet-btn" onclick="setBet(10)">10</button>
                <button class="bet-btn" onclick="setBet(25)">25</button>
                <button class="bet-btn" onclick="setBet(50)">50</button>
            </div>
            <button class="spin-btn m-load" id="spinBtn" onclick="doSpin()"><span id="spinTxt">...</span></button>
        </div>
        <button class="buy-bonus" onclick="buyBonus()">
            <div class="bb-left">üî• <span id="bbLabel">Buy Bonus</span></div>
            <div class="bb-right"><span id="bbPrice">500</span> ü™ô</div>
        </button>
    </div>
</div>

<!-- ===== SCREEN: PROFILE ===== -->
<div class="screen" id="scrProfile">
    <div class="profile-header">
        <div class="profile-avatar" id="profAvatar">üòé</div>
        <div class="profile-name" id="profName">Player</div>
        <div class="profile-vip" id="profVip">ü•â Bronze</div>
    </div>
    <div class="stat-grid">
        <div class="stat-card"><div class="stat-val" id="stSpins">0</div><div class="stat-label" id="stSpinsL">Spins</div></div>
        <div class="stat-card"><div class="stat-val" id="stWon">0</div><div class="stat-label" id="stWonL">Won</div></div>
        <div class="stat-card"><div class="stat-val" id="stBiggest">0</div><div class="stat-label" id="stBigL">Best Win</div></div>
        <div class="stat-card"><div class="stat-val" id="stProfit">0</div><div class="stat-label" id="stProfL">Profit</div></div>
    </div>
    <div class="profile-actions">
        <button class="profile-btn" onclick="nav('deposit')"><span class="pb-icon">üí≥</span><span id="profBuy">Buy Coins</span></button>
        <button class="profile-btn" onclick="shareRef()"><span class="pb-icon">üë•</span><span id="profRef">Invite Friends</span> <span id="profRefCnt" style="margin-left:auto;color:var(--accent)"></span></button>
        <button class="profile-btn" onclick="changeLang()"><span class="pb-icon">üåê</span><span id="profLang">Language</span></button>
    </div>
</div>

<!-- ===== BOTTOM NAV ===== -->
<div class="bottom-nav">
    <div class="nav-item active" data-screen="lobby" onclick="nav('lobby')"><div class="nav-icon">üè†</div><div class="nav-label" id="navLobby">Lobby</div></div>
    <div class="nav-item" data-screen="game" onclick="nav('game')"><div class="nav-icon">üé∞</div><div class="nav-label" id="navPlay">Play</div></div>
    <div class="nav-item" data-screen="profile" onclick="nav('profile')"><div class="nav-icon">üë§</div><div class="nav-label" id="navProfile">Profile</div><div class="nav-dot" id="wheelDot"></div></div>
</div>

<!-- ===== BONUS OVERLAY ===== -->
<div class="bonus-overlay" id="bonusOL">
    <div class="bo-title" id="boTitle">üé∞ BONUS ROUND üé∞</div>
    <div class="bo-info"><div class="bo-info-item"><div class="label" id="boSpinL">SPIN</div><div class="val" id="boSpinC">0/10</div></div><div class="bo-info-item"><div class="label" id="boTotalL">WIN</div><div class="val" id="boRunT">0</div></div></div>
    <div class="bo-grid-wrap"><div class="bo-grid" id="boGrid"></div></div>
    <div class="bo-result" id="boRes"></div>
    <div class="bo-total" id="boFinal"></div>
    <button class="bo-close" id="boClose" onclick="closeBonus()">COLLECT ü™ô</button>
</div>

<!-- ===== WHEEL OVERLAY ===== -->
<div class="wheel-overlay" id="wheelOL">
    <div class="wo-title" id="woTitle">üé° Daily Wheel</div>
    <div class="wo-wheel" id="woWheel">üé°</div>
    <div class="wo-prize" id="woPrize"></div>
    <button class="wo-btn" id="woBtn" onclick="spinWheel()">SPIN!</button>
</div>

<script>
const tg=window.Telegram.WebApp;tg.ready();tg.expand();
try{tg.setHeaderColor('#0a0a14');tg.setBackgroundColor('#0a0a14')}catch(e){}
const P=new URLSearchParams(location.search);
const API=P.get('api')||"https://lucky-slots-production.up.railway.app";
const BOT=P.get('bot')||"testplcas_bot";
const LANG=P.get('lang')||'pl';
const UID=P.get('uid')||'';
const TOK=P.get('token')||'';

// === LOCALE ===
const LC={
pl:{lobby:"Lobby",play:"Graj",profile:"Profil",spin:"ZAKRƒòƒÜ",deposit:"DEPOZYT",games:"Gry",coming:"Wkr√≥tce",buyBonus:"Kup Bonus",buyCoins:"Kup ≈ªetony",invite:"Zapro≈õ Znajomych",language:"Jƒôzyk",spins:"Spiny",won:"Wygrane",best:"Najlepsza",profit:"Zysk",wheel:"Ko≈Ço Dnia",wheelSub:"Krƒôƒá za darmowe monety!",wheelSpin:"KRƒòƒÜ!",collect:"ODBIERZ",bonusRound:"üé∞ RUNDA BONUSOWA üé∞",spinL:"SPIN",winL:"WYGRANA",promo:"Bonus Powitalny",promoT:"Lucky Bonanza üç≠",promoS:"Krƒôƒá i wygrywaj do x100!",noMoney:"Do≈Çaduj konto!",lose:"Brak wygranej",win:"WYGRANA",slotName:"Lucky Bonanza",slotTag:"GORƒÑCE",crashName:"Crash",diceName:"Ko≈õci",mineName:"Miny",coinName:"Coin Flip",comingTag:"WKR√ìTCE",freeSpins:"Darmowe spiny"},
ua:{lobby:"–õ–æ–±—ñ",play:"–ì—Ä–∞—Ç–∏",profile:"–ü—Ä–æ—Ñ—ñ–ª—å",spin:"–ì–†–ê–¢–ò",deposit:"–î–ï–ü–û–ó–ò–¢",games:"–Ü–≥—Ä–∏",coming:"–ù–µ–∑–∞–±–∞—Ä–æ–º",buyBonus:"–ö—É–ø–∏—Ç–∏ –ë–æ–Ω—É—Å",buyCoins:"–ö—É–ø–∏—Ç–∏ –ñ–µ—Ç–æ–Ω–∏",invite:"–ó–∞–ø—Ä–æ—Å–∏—Ç–∏ –î—Ä—É–∑—ñ–≤",language:"–ú–æ–≤–∞",spins:"–°–ø—ñ–Ω–∏",won:"–í–∏–≥—Ä–∞–Ω–æ",best:"–ù–∞–π–±—ñ–ª—å—à–∏–π",profit:"–ü—Ä–∏–±—É—Ç–æ–∫",wheel:"–ö–æ–ª–µ—Å–æ –î–Ω—è",wheelSub:"–ö—Ä—É—Ç–∏ –∑–∞ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ –º–æ–Ω–µ—Ç–∏!",wheelSpin:"–ö–†–£–¢–ò!",collect:"–ó–ê–ë–†–ê–¢–ò",bonusRound:"üé∞ –ë–û–ù–£–° –†–ê–£–ù–î üé∞",spinL:"–°–ü–Ü–ù",winL:"–í–ò–ì–†–ê–®",promo:"–í—ñ—Ç–∞–ª—å–Ω–∏–π –ë–æ–Ω—É—Å",promoT:"Lucky Bonanza üç≠",promoS:"–ö—Ä—É—Ç–∏ —Ç–∞ –≤–∏–≥—Ä–∞–≤–∞–π –¥–æ x100!",noMoney:"–ü–æ–ø–æ–≤–Ω—ñ—Ç—å!",lose:"–ë–µ–∑ –≤–∏–≥—Ä–∞—à—É",win:"–í–ò–ì–†–ê–®",slotName:"Lucky Bonanza",slotTag:"–ì–ê–†–Ø–ß–ï",crashName:"Crash",diceName:"–ö–æ—Å—Ç—ñ",mineName:"–ú—ñ–Ω–∏",coinName:"–ú–æ–Ω–µ—Ç–∫–∞",comingTag:"–ù–ï–ó–ê–ë–ê–†–û–ú",freeSpins:"–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ —Å–ø—ñ–Ω–∏"},
ru:{lobby:"–õ–æ–±–±–∏",play:"–ò–≥—Ä–∞—Ç—å",profile:"–ü—Ä–æ—Ñ–∏–ª—å",spin:"–ò–ì–†–ê–¢–¨",deposit:"–î–ï–ü–û–ó–ò–¢",games:"–ò–≥—Ä—ã",coming:"–°–∫–æ—Ä–æ",buyBonus:"–ö—É–ø–∏—Ç—å –ë–æ–Ω—É—Å",buyCoins:"–ö—É–ø–∏—Ç—å –ñ–µ—Ç–æ–Ω—ã",invite:"–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –î—Ä—É–∑–µ–π",language:"–Ø–∑—ã–∫",spins:"–°–ø–∏–Ω—ã",won:"–í—ã–∏–≥—Ä–∞–Ω–æ",best:"–õ—É—á—à–∏–π",profit:"–ü—Ä–æ—Ñ–∏—Ç",wheel:"–ö–æ–ª–µ—Å–æ –î–Ω—è",wheelSub:"–ö—Ä—É—Ç–∏ –∑–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–æ–Ω–µ—Ç—ã!",wheelSpin:"–ö–†–£–¢–ò!",collect:"–ó–ê–ë–†–ê–¢–¨",bonusRound:"üé∞ –ë–û–ù–£–° –†–ê–£–ù–î üé∞",spinL:"–°–ü–ò–ù",winL:"–í–´–ò–ì–†–´–®",promo:"–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –ë–æ–Ω—É—Å",promoT:"Lucky Bonanza üç≠",promoS:"–ö—Ä—É—Ç–∏ –∏ –≤—ã–∏–≥—Ä—ã–≤–∞–π –¥–æ x100!",noMoney:"–ü–æ–ø–æ–ª–Ω–∏—Ç–µ!",lose:"–ù–µ—Ç –≤—ã–∏–≥—Ä—ã—à–∞",win:"–í–´–ò–ì–†–´–®",slotName:"Lucky Bonanza",slotTag:"–ì–û–†–Ø–ß–ï–ï",crashName:"Crash",diceName:"–ö–æ—Å—Ç–∏",mineName:"–ú–∏–Ω—ã",coinName:"–ú–æ–Ω–µ—Ç–∫–∞",comingTag:"–°–ö–û–†–û",freeSpins:"–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Å–ø–∏–Ω—ã"},
en:{lobby:"Lobby",play:"Play",profile:"Profile",spin:"SPIN",deposit:"DEPOSIT",games:"Games",coming:"Coming Soon",buyBonus:"Buy Bonus",buyCoins:"Buy Coins",invite:"Invite Friends",language:"Language",spins:"Spins",won:"Won",best:"Best Win",profit:"Profit",wheel:"Daily Wheel",wheelSub:"Spin for free coins!",wheelSpin:"SPIN!",collect:"COLLECT",bonusRound:"üé∞ BONUS ROUND üé∞",spinL:"SPIN",winL:"WIN",promo:"Welcome Bonus",promoT:"Lucky Bonanza üç≠",promoS:"Spin & win up to x100!",noMoney:"Deposit!",lose:"No win",win:"WIN",slotName:"Lucky Bonanza",slotTag:"HOT",crashName:"Crash",diceName:"Dice",mineName:"Mines",coinName:"Coin Flip",comingTag:"SOON",freeSpins:"Free spins"}
};
const T=LC[LANG]||LC.en;
const BSYM=['üçí','üçã','üçä','üçá','üç´','üç≠','üç¨','üíé'];
const BONSYM=['üëë','üíé','‚≠ê','‚ù§Ô∏è','üçÄ','üß≤','üí∞','üåà'];
let balance=null,freeSpins=0,bet=5,spinning=false,currentScreen='lobby';

function auth(){const p={};if(tg.initData)p.init_data=tg.initData;if(UID)p.uid=UID;if(TOK)p.token=TOK;return p}
function qs(){return new URLSearchParams(auth()).toString()}
function sleep(ms){return new Promise(r=>setTimeout(r,ms))}

// === NAVIGATION ===
function nav(s){
    if(s==='deposit'){tg.openTelegramLink(`https://t.me/${BOT}?start=deposit`);tg.close();return}
    document.querySelectorAll('.screen').forEach(el=>el.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(el=>el.classList.remove('active'));
    const scr=document.getElementById('scr'+s.charAt(0).toUpperCase()+s.slice(1));
    if(scr)scr.classList.add('active');
    const ni=document.querySelector(`.nav-item[data-screen="${s}"]`);
    if(ni)ni.classList.add('active');
    currentScreen=s;
    if(s==='game')initGame();
    if(s==='profile')loadProfile();
}

// === DATA ===
async function loadBalance(){
    try{
        const r=await fetch(`${API}/api/balance?${qs()}`);const d=await r.json();
        if(d.ok){balance=d.balance;freeSpins=d.free_spins||0;updateBalanceUI();
            if(d.vip)updateVIP(d.vip);return}
    }catch(e){}
    setTimeout(loadBalance,2000);
}
function updateBalanceUI(){
    document.getElementById('lobbyBal').textContent=balance!==null?balance:'...';
    const gb=document.getElementById('gameBal');if(gb)gb.textContent=balance||0;
    const fb=document.getElementById('freeBadge');
    if(fb)fb.textContent=freeSpins>0?`‚ö° ${freeSpins} ${T.freeSpins}`:'';
    updateSpinBtn();
}
function updateVIP(v){
    document.getElementById('vipIcon').textContent=v.icon;
    document.getElementById('vipName').textContent=v.name;
    document.getElementById('vipCb').textContent=v.cb+'% cashback';
    const bar=document.getElementById('vipBar');
    if(v.next_at){const pct=Math.min(100,v.wagered/v.next_at*100);bar.style.width=pct+'%'}
    else bar.style.width='100%';
}

// === GAME ===
function initGame(){
    const g=document.getElementById('grid');
    if(!g.children.length){for(let i=0;i<30;i++){const c=document.createElement('div');c.className='cell';c.textContent=BSYM[Math.floor(Math.random()*BSYM.length)];g.appendChild(c)}}
    updateSpinBtn();
}
function updateSpinBtn(){
    const btn=document.getElementById('spinBtn'),txt=document.getElementById('spinTxt');
    btn.className='spin-btn';btn.disabled=false;
    if(balance===null){btn.classList.add('m-load');txt.textContent='...';btn.disabled=true}
    else if(balance<bet&&freeSpins<=0){btn.classList.add('m-deposit');txt.textContent=T.deposit}
    else{btn.classList.add('m-spin');txt.textContent=freeSpins>0?`‚ö° ${T.spin}`:T.spin}
}
function setBet(v){
    if(spinning)return;bet=v;
    document.querySelectorAll('.bet-btn').forEach(b=>b.classList.toggle('on',parseInt(b.textContent)===v));
    document.getElementById('bbPrice').textContent=v*100;updateSpinBtn();
}
function doSpin(){
    if(balance===null)return;
    if(balance<bet&&freeSpins<=0){nav('deposit');return}
    spin();
}
async function spin(){
    if(spinning)return;spinning=true;
    const btn=document.getElementById('spinBtn');btn.disabled=true;
    document.getElementById('gameResult').innerHTML='';
    document.querySelectorAll('#grid .cell').forEach(c=>c.className='cell');
    const cells=document.querySelectorAll('#grid .cell');
    const anim=setInterval(()=>cells.forEach(c=>c.textContent=BSYM[Math.floor(Math.random()*BSYM.length)]),70);
    try{
        const useFree=freeSpins>0&&balance<bet;
        const body={...auth(),bet,use_free_spin:useFree};
        const r=await fetch(`${API}/api/spin`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
        const d=await r.json();clearInterval(anim);
        if(!d.ok){spinning=false;btn.disabled=false;if(d.balance!==undefined)balance=d.balance;updateBalanceUI();return}
        balance=d.balance;freeSpins=d.free_spins||freeSpins;
        d.grid.forEach((s,i)=>{cells[i].textContent=s;if(s==='üé∞')cells[i].classList.add('scatter')});
        if(d.winnings>0){const co={};d.grid.forEach(s=>{if(s!=='üé∞')co[s]=(co[s]||0)+1});
            const ws=new Set(Object.entries(co).filter(([,c])=>c>=8).map(([s])=>s));
            cells.forEach(c=>{if(ws.has(c.textContent))c.classList.add('win')})}
        const res=document.getElementById('gameResult');
        if(d.triggered_bonus){res.innerHTML=`<span style="color:var(--pink)">üé∞ BONUS! ${d.scatter_count}x</span>`;
            updateBalanceUI();setTimeout(()=>startBonus('triggered'),1200)}
        else{res.innerHTML=d.winnings>0?`<span style="color:var(--green)">${T.win}: +${d.winnings} ü™ô</span>`:`<span style="color:var(--dim)">${T.lose}</span>`;updateBalanceUI()}
    }catch(e){clearInterval(anim)}
    spinning=false;btn.disabled=false;
}

// === BONUS ROUND ===
async function startBonus(mode){
    spinning=true;const ol=document.getElementById('bonusOL');ol.classList.add('show');
    document.getElementById('boTitle').textContent=T.bonusRound;
    document.getElementById('boSpinL').textContent=T.spinL;document.getElementById('boTotalL').textContent=T.winL;
    document.getElementById('boClose').style.display='none';document.getElementById('boFinal').textContent='';document.getElementById('boRes').textContent='';
    document.getElementById('boSpinC').textContent='0/10';document.getElementById('boRunT').textContent='0';
    const bg=document.getElementById('boGrid');bg.innerHTML='';
    for(let i=0;i<30;i++){const c=document.createElement('div');c.className='cell';c.textContent=BONSYM[Math.floor(Math.random()*BONSYM.length)];bg.appendChild(c)}
    try{
        const r=await fetch(`${API}/api/bonus`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({...auth(),bet,mode})});
        const d=await r.json();if(!d.ok){closeBonus();return}
        const bc=bg.querySelectorAll('.cell');
        for(const sp of d.spins){
            document.getElementById('boSpinC').textContent=`${sp.spin_number}/${sp.total_spins}`;
            for(let t=0;t<6;t++){bc.forEach(c=>c.textContent=BONSYM[Math.floor(Math.random()*BONSYM.length)]);await sleep(50)}
            sp.grid.forEach((s,i)=>{bc[i].textContent=s;bc[i].className='cell';if(s==='üé∞')bc[i].classList.add('scatter');else if(s==='üí£')bc[i].classList.add('bomb')});
            if(sp.winning_symbols){const ws=new Set(Object.keys(sp.winning_symbols));bc.forEach(c=>{if(ws.has(c.textContent))c.classList.add('win')})}
            await sleep(200);
            if(sp.bombs&&sp.bombs.length>0&&sp.base_win>0){for(const b of sp.bombs){showBombPop(b.mult);await sleep(400)}}
            document.getElementById('boRes').innerHTML=sp.winnings>0?`<span style="color:var(--green)">+${sp.winnings}${sp.total_bomb_mult>1?' üí£x'+sp.total_bomb_mult:''}</span>`:'‚Äî';
            if(sp.retrigger){document.getElementById('boRes').innerHTML+=`<br><span style="color:var(--pink)">+5!</span>`;await sleep(600)}
            document.getElementById('boRunT').textContent=sp.running_total;await sleep(400);
        }
        balance=d.balance;document.getElementById('boRes').textContent='';
        document.getElementById('boFinal').innerHTML=`üèÜ ${d.total_win} ü™ô`;
        const cb=document.getElementById('boClose');cb.textContent=`${T.collect} ${d.total_win} ü™ô`;cb.style.display='block';
    }catch(e){closeBonus()}
}
function closeBonus(){document.getElementById('bonusOL').classList.remove('show');spinning=false;updateBalanceUI()}
function showBombPop(m){const e=document.createElement('div');e.className='bomb-pop';e.textContent=`üí£ x${m}`;document.body.appendChild(e);setTimeout(()=>e.remove(),800)}
async function buyBonus(){if(!balance||balance<bet*100){tg.showAlert(T.noMoney);return}startBonus('bought')}

// === DAILY WHEEL ===
async function openWheel(){
    document.getElementById('wheelOL').classList.add('show');
    document.getElementById('woTitle').textContent='üé° '+T.wheel;
    document.getElementById('woBtn').textContent=T.wheelSpin;
    document.getElementById('woPrize').textContent='';document.getElementById('woBtn').disabled=false;
}
async function spinWheel(){
    document.getElementById('woBtn').disabled=true;
    const wheel=document.getElementById('woWheel');
    wheel.style.transition='transform 3s cubic-bezier(.17,.67,.12,.99)';
    wheel.style.transform=`rotate(${1440+Math.random()*360}deg)`;
    try{
        const r=await fetch(`${API}/api/wheel`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(auth())});
        const d=await r.json();
        await sleep(3200);
        if(d.ok){
            balance=d.balance;freeSpins=d.free_spins||0;
            const p=d.prize;
            document.getElementById('woPrize').textContent=p.type==='coins'?`+${p.value} ü™ô`:`+${p.value} ‚ö°`;
            document.getElementById('wheelBanner').classList.add('done');
            updateBalanceUI();
        }else{document.getElementById('woPrize').textContent='‚è≥'}
    }catch(e){}
    const cb=document.getElementById('woBtn');cb.textContent='‚úì';
    setTimeout(()=>{document.getElementById('wheelOL').classList.remove('show');wheel.style.transition='none';wheel.style.transform='rotate(0)'},2000);
}

// === PROFILE ===
async function loadProfile(){
    try{
        const r=await fetch(`${API}/api/profile?${qs()}`);const d=await r.json();
        if(!d.ok)return;
        document.getElementById('profName').textContent=d.first_name||d.username||'Player';
        document.getElementById('profVip').textContent=`${d.vip.icon} ${d.vip.name}`;
        document.getElementById('stSpins').textContent=d.stats.spins;
        document.getElementById('stWon').textContent=d.stats.won;
        document.getElementById('stBiggest').textContent=d.stats.biggest;
        const prof=d.stats.profit;
        const pe=document.getElementById('stProfit');pe.textContent=(prof>=0?'+':'')+prof;pe.style.color=prof>=0?'var(--green)':'var(--red)';
        document.getElementById('profRefCnt').textContent=d.refs>0?d.refs:'';
    }catch(e){}
}
function shareRef(){tg.openTelegramLink(`https://t.me/share/url?url=https://t.me/${BOT}?start=ref${UID}&text=üé∞`)}
function changeLang(){tg.openTelegramLink(`https://t.me/${BOT}`);tg.close()}

// === WHEEL STATUS ===
async function checkWheel(){
    try{const r=await fetch(`${API}/api/wheel-status?${qs()}`);const d=await r.json();
        if(d.ok&&!d.available)document.getElementById('wheelBanner').classList.add('done')}catch(e){}}

// === INIT ===
function initLocale(){
    document.getElementById('navLobby').textContent=T.lobby;
    document.getElementById('navPlay').textContent=T.play;
    document.getElementById('navProfile').textContent=T.profile;
    document.getElementById('secGames').textContent=T.games;
    document.getElementById('secComing').textContent=T.coming;
    document.getElementById('promoTag').textContent=T.promo;
    document.getElementById('promoTitle').textContent=T.promoT;
    document.getElementById('promoSub').textContent=T.promoS;
    document.getElementById('wheelTitle').textContent=T.wheel;
    document.getElementById('wheelSub').textContent=T.wheelSub;
    document.getElementById('bbLabel').textContent=T.buyBonus;
    document.getElementById('profBuy').textContent=T.buyCoins;
    document.getElementById('profRef').textContent=T.invite;
    document.getElementById('profLang').textContent=T.language;
    document.getElementById('stSpinsL').textContent=T.spins;
    document.getElementById('stWonL').textContent=T.won;
    document.getElementById('stBigL').textContent=T.best;
    document.getElementById('stProfL').textContent=T.profit;
}

function buildGameCards(){
    const gr=document.getElementById('gamesRow');
    gr.innerHTML=`<div class="game-card" onclick="nav('game')"><div class="game-card-img slots-bg">üç≠</div><div class="game-card-info"><div class="game-card-name">${T.slotName}</div><div class="game-card-tag">${T.slotTag}</div></div></div>`;
    const cr=document.getElementById('comingRow');
    const coming=[{e:'üìà',n:T.crashName},{e:'üé≤',n:T.diceName},{e:'üí£',n:T.mineName},{e:'ü™ô',n:T.coinName}];
    cr.innerHTML=coming.map(g=>`<div class="game-card"><div class="game-card-img coming-bg">${g.e}<div class="coming-label">${T.comingTag}</div></div><div class="game-card-info"><div class="game-card-name">${g.n}</div><div class="game-card-tag" style="color:var(--dim)">${T.comingTag}</div></div></div>`).join('');
}

initLocale();buildGameCards();loadBalance();checkWheel();
</script>
</body>
</html>
