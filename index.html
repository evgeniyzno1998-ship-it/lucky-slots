<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>RubyBet</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#121212;--surface:#1E1E1E;--surface2:#2A2A2A;--surface3:#333;
  --red:#E31E24;--red-dark:#B91820;--red-glow:rgba(227,30,36,0.4);
  --text:#F5F5F5;--dim:#9CA3AF;--dim2:#6B7280;--border:#333;
  --green:#22C55E;--green-dim:#166534;--gold:#FFD700;--blue:#3B82F6;
  --radius:12px;--radius-lg:16px;--radius-xl:20px;
  --nav-h:68px;--header-h:56px;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
body{background:var(--bg);color:var(--text);font-family:'Inter',sans-serif;min-height:100vh;overflow-x:hidden;padding-bottom:calc(var(--nav-h) + 12px)}
::-webkit-scrollbar{width:3px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#333;border-radius:3px}
h1,h2,h3,.font-display{font-family:'Montserrat',sans-serif}
::selection{background:var(--red);color:#fff}

/* === SCREENS === */
.screen{display:none;opacity:0;transition:opacity .15s ease}.screen.active{display:block;opacity:1}

/* === HEADER === */
.header{position:sticky;top:0;z-index:50;background:var(--bg);border-bottom:1px solid rgba(255,255,255,.05);padding:10px 16px;display:flex;align-items:center;justify-content:space-between;height:var(--header-h);backdrop-filter:blur(12px)}
.logo{display:flex;align-items:center;gap:6px}
.logo-icon{width:32px;height:32px;background:var(--red);border-radius:8px;display:flex;align-items:center;justify-content:center;box-shadow:0 0 12px var(--red-glow)}
.logo-icon .material-symbols-outlined{color:#fff;font-size:18px}
.logo-text{font-family:'Montserrat',sans-serif;font-weight:800;font-size:18px;letter-spacing:.5px;color:#fff}
.logo-text span{color:var(--red)}
.header-right{display:flex;align-items:center;gap:8px}
.header-bal{display:flex;align-items:center;gap:6px;background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:5px 12px 5px 8px;font-weight:600;font-size:13px;color:#fff;cursor:pointer}
.header-bal .amt{color:var(--red);font-weight:700;font-family:'Montserrat',sans-serif;font-size:11px;margin-left:2px}
.header-notif{position:relative;width:36px;height:36px;border-radius:50%;background:var(--surface);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer}
.header-notif .material-symbols-outlined{font-size:18px;color:var(--dim)}
.header-notif .dot{position:absolute;top:6px;right:6px;width:7px;height:7px;background:var(--red);border-radius:50%;box-shadow:0 0 6px var(--red)}

/* === BOTTOM NAV === */
.bottom-nav{position:fixed;bottom:0;left:0;right:0;height:var(--nav-h);background:var(--surface);border-top:1px solid rgba(255,255,255,.05);display:flex;z-index:100;padding-bottom:env(safe-area-inset-bottom);box-shadow:0 -4px 20px rgba(0,0,0,.4)}
.nav-item{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;cursor:pointer;color:var(--dim);transition:color .2s;position:relative}
.nav-item.active{color:var(--red)}
.nav-item .material-symbols-outlined{font-size:22px;transition:all .2s}
.nav-item.active .material-symbols-outlined{filter:drop-shadow(0 0 6px var(--red-glow))}
.nav-item .nav-label{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;font-family:'Montserrat',sans-serif}

/* === SHARED UI === */
.section{padding:0 16px;margin-bottom:20px}
.section-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.section-title{font-family:'Montserrat',sans-serif;font-size:11px;font-weight:800;text-transform:uppercase;letter-spacing:1.5px;color:var(--dim)}
.section-more{font-size:11px;font-weight:700;color:var(--red);cursor:pointer;text-transform:uppercase;letter-spacing:.5px}
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden}
.btn-primary{width:100%;height:48px;border-radius:var(--radius);border:none;background:var(--red);color:#fff;font-family:'Montserrat',sans-serif;font-weight:700;font-size:14px;letter-spacing:.5px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;box-shadow:0 4px 16px var(--red-glow);transition:all .15s;text-transform:uppercase}
.btn-primary:active{transform:scale(.97);filter:brightness(.9)}
.btn-outline{width:100%;height:48px;border-radius:var(--radius);border:1.5px solid var(--red);background:transparent;color:var(--red);font-family:'Montserrat',sans-serif;font-weight:700;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:all .15s;text-transform:uppercase}
.btn-outline:active{background:rgba(227,30,36,.08);transform:scale(.97)}
.pill-row{display:flex;gap:8px;overflow-x:auto;padding:0 16px 12px;-ms-overflow-style:none;scrollbar-width:none}
.pill-row::-webkit-scrollbar{display:none}
.pill{height:34px;padding:0 16px;border-radius:17px;border:1px solid var(--border);background:var(--surface);color:var(--dim);font-size:12px;font-weight:600;white-space:nowrap;cursor:pointer;display:flex;align-items:center;transition:all .15s;flex-shrink:0}
.pill.active{background:var(--red);color:#fff;border-color:var(--red);box-shadow:0 2px 10px var(--red-glow)}
.pill:active{transform:scale(.95)}
.divider{height:1px;background:var(--border);margin:0 16px}

/* ======================== */
/* === LOBBY SCREEN === */
/* ======================== */
.lobby-search{margin:12px 16px;display:flex;align-items:center;gap:10px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:10px 14px;cursor:pointer}
.lobby-search .material-symbols-outlined{color:var(--dim);font-size:20px}
.lobby-search span{color:var(--dim2);font-size:13px;font-weight:500}

/* Hero Banner */
.hero-banner{margin:0 16px 16px;border-radius:var(--radius-xl);background:linear-gradient(135deg,#1a0000,#3a0a0a 50%,#0a0000);border:1.5px solid rgba(227,30,36,.3);padding:24px 20px;position:relative;overflow:hidden;min-height:140px;box-shadow:0 0 20px rgba(227,30,36,.1)}
.hero-banner::after{content:'';position:absolute;top:-50%;right:-20%;width:200px;height:200px;background:radial-gradient(circle,rgba(227,30,36,.15),transparent 70%);border-radius:50%}
.hero-tag{display:inline-flex;align-items:center;gap:4px;font-size:10px;font-weight:800;text-transform:uppercase;color:#fff;background:var(--red);padding:3px 8px;border-radius:4px;margin-bottom:10px;letter-spacing:1px}
.hero-tag .material-symbols-outlined{font-size:12px}
.hero-title{font-family:'Montserrat',sans-serif;font-size:28px;font-weight:900;line-height:1.15;margin-bottom:4px;letter-spacing:-.5px}
.hero-title .accent{color:var(--red);text-shadow:0 0 20px var(--red-glow)}
.hero-sub{font-size:12px;color:var(--dim);margin-bottom:16px}
.hero-actions{display:flex;gap:10px;position:relative;z-index:1}
.hero-actions .hero-btn{height:38px;padding:0 20px;border-radius:10px;border:none;font-family:'Montserrat',sans-serif;font-weight:700;font-size:12px;cursor:pointer;display:flex;align-items:center;gap:6px;transition:all .15s;text-transform:uppercase;letter-spacing:.5px}
.hero-actions .hero-btn:active{transform:scale(.95)}
.hero-btn.filled{background:var(--red);color:#fff;box-shadow:0 2px 12px var(--red-glow)}
.hero-btn.ghost{background:rgba(255,255,255,.08);color:#fff;border:1px solid rgba(255,255,255,.12)}

/* Wheel Banner */
.wheel-banner{margin:0 16px 16px;border-radius:var(--radius-lg);background:linear-gradient(135deg,#0a1a0a,#0a2a1a);border:1px solid rgba(34,197,94,.2);padding:14px 16px;display:flex;align-items:center;gap:12px;cursor:pointer;transition:transform .15s}
.wheel-banner:active{transform:scale(.97)}
.wheel-icon{font-size:32px;animation:wrot 3s linear infinite}
@keyframes wrot{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
.wheel-banner.done{opacity:.4;pointer-events:none}.wheel-banner.done .wheel-icon{animation:none}
.wheel-info h3{font-size:13px;font-weight:700;color:var(--green);font-family:'Montserrat',sans-serif}
.wheel-info p{font-size:11px;color:var(--dim)}

/* VIP Progress */
.vip-strip{margin:0 16px 16px;display:flex;align-items:center;gap:12px}
.vip-strip-info{flex:1}
.vip-strip-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.vip-strip-name{font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:1.5px;color:var(--dim);font-family:'Montserrat',sans-serif}
.vip-strip-pct{font-size:10px;font-weight:700;color:var(--red)}
.vip-bar{height:6px;background:var(--surface);border:1px solid var(--border);border-radius:3px;overflow:hidden}
.vip-bar-fill{height:100%;background:var(--red);border-radius:3px;transition:width .6s;box-shadow:0 0 8px var(--red-glow)}

/* Categories */
.cat-row{display:flex;gap:12px;padding:0 16px;margin-bottom:20px;overflow-x:auto;-ms-overflow-style:none;scrollbar-width:none}
.cat-row::-webkit-scrollbar{display:none}
.cat-item{display:flex;flex-direction:column;align-items:center;gap:6px;cursor:pointer;flex-shrink:0}
.cat-icon{width:56px;height:56px;border-radius:var(--radius);background:var(--surface);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;transition:all .15s}
.cat-icon .material-symbols-outlined{font-size:24px;color:var(--red)}
.cat-item:active .cat-icon{border-color:var(--red);background:rgba(227,30,36,.08)}
.cat-label{font-size:10px;font-weight:600;color:var(--dim);text-transform:uppercase;letter-spacing:.5px}

/* Game Grid */
.game-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:0 16px;margin-bottom:20px}
.game-tile{border-radius:var(--radius-lg);overflow:hidden;background:var(--surface);border:1px solid var(--border);cursor:pointer;transition:all .15s;position:relative}
.game-tile:active{transform:scale(.96)}
.game-tile-img{width:100%;aspect-ratio:4/3;display:flex;align-items:center;justify-content:center;font-size:42px;position:relative}
.game-tile-img .badge{position:absolute;top:8px;right:8px;font-size:9px;font-weight:800;text-transform:uppercase;padding:2px 8px;border-radius:4px;letter-spacing:.5px}
.badge.hot{background:var(--red);color:#fff}
.badge.new{background:var(--green);color:#fff}
.badge.soon{background:var(--surface2);color:var(--dim)}
.game-tile-info{padding:10px 12px}
.game-tile-name{font-family:'Montserrat',sans-serif;font-size:12px;font-weight:800;text-transform:uppercase;letter-spacing:.3px}
.game-tile-tag{font-size:10px;color:var(--dim);font-weight:500;margin-top:2px}

/* ======================== */
/* === GAME SCREEN === */
/* ======================== */
.game-header{display:flex;justify-content:space-between;align-items:center;padding:8px 16px}
.game-back{display:flex;align-items:center;gap:4px;cursor:pointer;color:var(--dim);font-size:13px;font-weight:600}
.game-back .material-symbols-outlined{font-size:20px}
.game-title-bar{font-family:'Montserrat',sans-serif;font-weight:800;font-size:14px;text-transform:uppercase;letter-spacing:.5px}
.game-bal{display:flex;align-items:center;gap:4px;background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:4px 12px;font-weight:700;font-size:13px}
.game-bal .material-symbols-outlined{font-size:14px;color:var(--red)}

/* Jackpot display */
.jackpot-display{text-align:center;padding:8px 0 4px}
.jackpot-label{font-size:9px;font-weight:800;text-transform:uppercase;letter-spacing:2px;color:var(--red)}
.jackpot-amount{font-family:'Montserrat',sans-serif;font-size:28px;font-weight:900;color:#fff;letter-spacing:-1px}
.jackpot-amount span{color:var(--dim);font-size:16px;font-weight:600;margin-left:4px}

/* Grid */
.grid-frame{margin:0 10px;background:rgba(0,0,0,.4);border:2px solid rgba(227,30,36,.15);border-radius:var(--radius-lg);padding:6px;position:relative;overflow:hidden}
.grid-frame.bonus-mode{border-color:var(--red);box-shadow:0 0 30px var(--red-glow)}
.grid{display:grid;grid-template-columns:repeat(6,1fr);gap:3px}
.cell{aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-size:22px;border-radius:8px;background:rgba(255,255,255,.03);transition:all .2s}
.cell.win{background:rgba(227,30,36,.15);transform:scale(1.08)}.cell.scatter{background:rgba(227,30,36,.2);animation:sc-p .5s infinite}
.cell.bomb{background:rgba(255,61,0,.2);animation:bm-s .3s infinite}
@keyframes sc-p{0%,100%{transform:scale(1)}50%{transform:scale(1.12)}}
@keyframes bm-s{0%,100%{transform:rotate(0)}25%{transform:rotate(-2deg)}75%{transform:rotate(2deg)}}

.game-result{text-align:center;height:32px;font-weight:800;font-size:16px;padding:6px 0;display:flex;align-items:center;justify-content:center}
.game-result .win-text{color:var(--green);display:flex;align-items:center;gap:4px}
.game-result .lose-text{color:var(--dim)}
.free-spin-badge{text-align:center;padding:2px;font-size:11px;color:var(--red);font-weight:700}

/* Controls ‚Äî Stitch-style layout */
.game-controls{display:flex;gap:10px;align-items:center;justify-content:center;padding:8px 10px 4px}
.ctrl-side-btn{width:56px;height:56px;border-radius:var(--radius);border:none;background:var(--surface2);color:var(--dim);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;cursor:pointer;font-family:'Montserrat',sans-serif;font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;transition:all .15s}
.ctrl-side-btn:active{transform:scale(.93);background:var(--surface3)}
.ctrl-side-btn .material-symbols-outlined{font-size:20px}

.spin-btn{width:90px;height:70px;border-radius:var(--radius);border:none;font-family:'Montserrat',sans-serif;font-weight:900;cursor:pointer;font-size:11px;transition:all .2s;text-transform:uppercase;letter-spacing:.5px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;position:relative}
.spin-btn .material-symbols-outlined{font-size:28px}
.spin-btn.m-spin{background:var(--red);color:#fff;box-shadow:0 4px 20px var(--red-glow)}
.spin-btn.m-deposit{background:var(--green);color:#fff;animation:glow-g 1.5s infinite}
.spin-btn.m-load{background:var(--surface);color:var(--dim)}
@keyframes glow-g{0%,100%{box-shadow:0 0 8px rgba(34,197,94,.3)}50%{box-shadow:0 0 20px rgba(34,197,94,.5)}}
.spin-btn:disabled{opacity:.4;cursor:not-allowed}
.spin-btn:active:not(:disabled){transform:scale(.93)}

/* Bet amount strip ‚Äî [‚àí] ‚Äî‚Äî‚Äî 5.0 coins ‚Äî‚Äî‚Äî [+] */
.bet-strip{display:flex;align-items:center;margin:4px 10px 0;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);height:48px;overflow:hidden}
.bet-strip-btn{width:54px;height:100%;border:none;background:transparent;color:var(--dim);font-size:22px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .12s;font-family:'Inter',sans-serif;flex-shrink:0}
.bet-strip-btn:active{background:rgba(255,255,255,.05);color:#fff}
.bet-strip-val{flex:1;text-align:center;font-family:'Montserrat',sans-serif;font-weight:800;font-size:16px;color:#fff;letter-spacing:.3px;user-select:none}
.bet-strip-val .bet-unit{color:var(--red);font-size:12px;font-weight:700;margin-left:4px;text-transform:uppercase}
.bet-strip-label{display:block;font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--dim2);text-align:center;margin-top:2px;padding:0 10px}

/* Buy bonus */
.buy-bonus{width:calc(100% - 20px);margin:6px 10px 0;padding:12px 14px;border-radius:var(--radius);border:1.5px solid rgba(227,30,36,.2);background:transparent;color:#fff;display:flex;justify-content:space-between;align-items:center;cursor:pointer;font-family:'Inter',sans-serif;font-size:13px;transition:all .15s}
.buy-bonus:active{transform:scale(.97);background:rgba(227,30,36,.05)}
.bb-left{font-weight:700;display:flex;align-items:center;gap:6px}.bb-right{font-weight:800;color:var(--red)}

/* Speed row (hidden inside AUTO now, but keep for turbo toggle) */
.speed-row{display:none}

/* ======================== */
/* === BONUSES SCREEN === */
/* ======================== */
.bonus-featured{margin:0 16px 16px;border-radius:var(--radius-xl);background:linear-gradient(180deg,rgba(227,30,36,.08),var(--surface) 60%);border:1.5px solid rgba(227,30,36,.25);overflow:hidden;min-height:200px;display:flex;flex-direction:column;justify-content:flex-end;position:relative;box-shadow:0 0 16px rgba(227,30,36,.08)}
.bonus-featured-content{padding:20px;position:relative;z-index:1}
.bonus-featured .bf-tags{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.bf-tag{font-size:9px;font-weight:800;text-transform:uppercase;padding:3px 8px;border-radius:4px;letter-spacing:1px;background:rgba(227,30,36,.15);color:var(--red);border:1px solid rgba(227,30,36,.2)}
.bf-timer{display:flex;align-items:center;gap:4px;font-size:10px;color:var(--dim);font-weight:500}
.bf-timer .material-symbols-outlined{font-size:12px}
.bf-title{font-family:'Montserrat',sans-serif;font-size:24px;font-weight:900;color:#fff;margin-bottom:4px;letter-spacing:-.3px}
.bf-desc{font-size:12px;color:var(--dim);line-height:1.5;margin-bottom:16px}
.bf-bottom{display:flex;justify-content:space-between;align-items:center;padding-top:12px;border-top:1px solid rgba(255,255,255,.06)}
.bf-wager-label{font-size:9px;text-transform:uppercase;font-weight:800;color:var(--dim2);letter-spacing:1px}
.bf-wager-val{font-weight:800;color:#fff;font-size:14px}
.bf-activate{height:38px;padding:0 20px;border-radius:20px;border:none;background:var(--red);color:#fff;font-family:'Montserrat',sans-serif;font-weight:700;font-size:12px;cursor:pointer;display:flex;align-items:center;gap:6px;box-shadow:0 2px 12px var(--red-glow);transition:all .15s;text-transform:uppercase}
.bf-activate:active{transform:scale(.95)}
.bf-activate .material-symbols-outlined{font-size:16px}

/* Bonus list card */
.bonus-card{margin:0 16px 12px;border-radius:var(--radius-lg);background:var(--surface);border:1px solid var(--border);overflow:hidden;display:flex;transition:border-color .2s}
.bonus-card:active{border-color:rgba(227,30,36,.3)}
.bonus-card-img{width:33%;min-height:110px;display:flex;align-items:center;justify-content:center;font-size:36px;position:relative}
.bonus-card-img::after{content:'';position:absolute;right:0;top:0;bottom:0;width:30px;background:linear-gradient(90deg,transparent,var(--surface))}
.bonus-card-body{flex:1;padding:14px 14px 14px 8px;display:flex;flex-direction:column;justify-content:center}
.bonus-card-title{font-family:'Montserrat',sans-serif;font-size:15px;font-weight:800;color:#fff;margin-bottom:4px}
.bonus-card-desc{font-size:11px;color:var(--dim);line-height:1.4;margin-bottom:10px}
.bonus-card-btn{height:32px;padding:0 16px;border-radius:16px;border:1.5px solid var(--red);background:transparent;color:var(--red);font-family:'Montserrat',sans-serif;font-weight:700;font-size:11px;cursor:pointer;transition:all .15s;text-transform:uppercase;align-self:flex-start}
.bonus-card-btn:active{background:rgba(227,30,36,.08)}

/* Locked bonus */
.bonus-locked{margin:0 16px 12px;border-radius:var(--radius-lg);background:var(--surface);border:1px solid var(--border);overflow:hidden;display:flex;opacity:.5}
.bonus-locked .lock-icon{position:absolute;top:10px;right:10px;background:rgba(0,0,0,.6);border-radius:50%;width:28px;height:28px;display:flex;align-items:center;justify-content:center}

/* Bonus Segments */
.bonus-seg{background:transparent;color:var(--dim)}
.bonus-seg.active{background:var(--surface2);color:#fff;border:1px solid rgba(255,255,255,.08)!important;box-shadow:0 2px 8px rgba(0,0,0,.3)}

/* Glass Bonus Card */
.glass-card{background:linear-gradient(135deg,var(--surface) 0%,var(--surface2) 100%);border:1px solid rgba(227,30,36,.3);border-radius:14px;padding:20px;position:relative;overflow:hidden}
.glass-card .gc-bg-icon{position:absolute;top:0;right:0;padding:16px;opacity:.07}
.glass-card .gc-bg-icon .material-symbols-outlined{font-size:56px;color:var(--red)}
.gc-title{font-family:'Montserrat',sans-serif;font-size:18px;font-weight:800;color:#fff;margin-bottom:4px;position:relative;z-index:1}
.gc-desc{font-size:12px;color:var(--dim);line-height:1.4;margin-bottom:14px;position:relative;z-index:1}
.gc-progress{margin-bottom:16px;position:relative;z-index:1}
.gc-progress-header{display:flex;justify-content:space-between;font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:.8px;margin-bottom:6px}
.gc-progress-header .label{color:var(--red)}
.gc-progress-header .val{color:#fff}
.gc-progress-bar{width:100%;height:5px;background:rgba(227,30,36,.15);border-radius:3px;overflow:hidden}
.gc-progress-fill{height:100%;background:var(--red);border-radius:3px;transition:width .5s}
.gc-btn-primary{width:100%;height:42px;border:none;border-radius:8px;background:var(--red);color:#fff;font-family:'Montserrat',sans-serif;font-weight:800;font-size:12px;text-transform:uppercase;letter-spacing:1.5px;cursor:pointer;transition:all .15s;position:relative;z-index:1}
.gc-btn-primary:active{transform:scale(.97);opacity:.9}
.gc-btn-outline{width:100%;height:42px;border:1.5px solid rgba(227,30,36,.4);border-radius:8px;background:rgba(227,30,36,.06);color:var(--red);font-family:'Montserrat',sans-serif;font-weight:800;font-size:12px;text-transform:uppercase;letter-spacing:1.5px;cursor:pointer;transition:all .15s;position:relative;z-index:1}
.gc-btn-outline:active{transform:scale(.97);background:rgba(227,30,36,.12)}
.gc-timer{display:flex;align-items:center;gap:10px;padding:10px 12px;background:rgba(0,0,0,.3);border:1px solid var(--border);border-radius:8px;margin-bottom:16px;position:relative;z-index:1}
.gc-timer .material-symbols-outlined{color:var(--red);font-size:20px}
.gc-timer-label{font-size:9px;text-transform:uppercase;font-weight:800;color:var(--dim2);letter-spacing:1px;line-height:1}
.gc-timer-val{font-size:12px;font-weight:800;color:#fff;text-transform:uppercase;letter-spacing:2px}
.gc-vip-tag{padding:3px 8px;font-size:9px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;background:rgba(227,30,36,.15);color:var(--red);border:1px solid rgba(227,30,36,.25);border-radius:4px}

/* History Item */
.history-item{background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:12px;padding:14px;transition:all .15s}
.history-item.expired{opacity:.6}
.hi-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}
.hi-icon{width:40px;height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.hi-icon.active{background:rgba(227,30,36,.08);border:1px solid rgba(227,30,36,.15)}
.hi-icon.inactive{background:var(--surface2);border:1px solid var(--border)}
.hi-info{flex:1;margin-left:10px}
.hi-title{font-family:'Montserrat',sans-serif;font-size:13px;font-weight:800;color:#fff;letter-spacing:.3px}
.hi-date{font-size:10px;color:var(--dim2);margin-top:2px}
.hi-amount{text-align:right}
.hi-val{font-size:13px;font-weight:800;color:#fff}
.hi-val-label{font-size:9px;font-weight:800;text-transform:uppercase;color:var(--dim2)}
.hi-bottom{display:flex;align-items:center;justify-content:space-between;padding-top:10px;border-top:1px solid var(--border)}
.hi-status{display:flex;align-items:center;gap:5px;font-size:11px;font-weight:600;color:var(--dim)}
.hi-status .material-symbols-outlined{font-size:16px}
.hi-status.completed .material-symbols-outlined{color:var(--red)}
.hi-status.completed{color:var(--text)}
.hi-badge{font-size:9px;font-weight:800;padding:4px 8px;border-radius:4px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);color:var(--dim2);text-transform:uppercase;letter-spacing:.5px}
.bonus-locked .lock-icon .material-symbols-outlined{font-size:14px;color:var(--dim)}
.bonus-locked-body{flex:1;padding:14px;position:relative}
.bonus-locked .bl-title{font-family:'Montserrat',sans-serif;font-size:14px;font-weight:800;color:var(--dim)}
.bonus-locked .bl-desc{font-size:10px;color:var(--dim2);margin-bottom:8px}
.bl-progress{height:4px;background:var(--surface2);border-radius:2px;overflow:hidden}
.bl-progress-fill{height:100%;background:var(--dim);border-radius:2px}
.bl-progress-label{font-size:9px;color:var(--dim2);text-align:right;margin-top:3px}

/* ======================== */
/* === WALLET SCREEN === */
/* ======================== */
.wallet-balance{text-align:center;padding:24px 16px 16px}
.wallet-balance-label{font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:2px;color:var(--dim);font-family:'Montserrat',sans-serif;margin-bottom:4px}
.wallet-balance-amount{display:flex;align-items:baseline;justify-content:center;gap:8px}
.wallet-balance-amount h1{font-family:'Montserrat',sans-serif;font-size:48px;font-weight:900;color:#fff;letter-spacing:-2px}
.wallet-balance-amount .unit{font-family:'Montserrat',sans-serif;font-size:22px;font-weight:700;color:var(--red)}
.wallet-balance-usd{font-size:13px;color:var(--dim);margin-top:2px}

.wallet-actions{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:0 16px;margin-bottom:16px}
.wallet-actions .btn-primary{height:50px;font-size:13px}
.wallet-actions .btn-outline{height:50px;font-size:13px}
.wallet-history-btn{margin:0 16px 16px;height:44px;border-radius:var(--radius);border:1px solid var(--border);background:var(--surface);color:var(--dim);font-family:'Inter',sans-serif;font-weight:500;font-size:13px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:all .15s;width:calc(100% - 32px)}
.wallet-history-btn:active{background:var(--surface2)}
.wallet-history-btn .material-symbols-outlined{font-size:18px}

.wallet-assets{padding:0 16px;margin-bottom:16px}
.wallet-assets-label{font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:1.5px;color:var(--dim);font-family:'Montserrat',sans-serif;margin-bottom:10px}
.asset-row{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.asset-btn{height:42px;border-radius:var(--radius);border:1px solid var(--border);background:var(--surface);color:var(--dim);font-family:'Montserrat',sans-serif;font-weight:600;font-size:13px;cursor:pointer;transition:all .15s}
.asset-btn.active{border:2px solid var(--red);color:#fff;background:rgba(227,30,36,.06);box-shadow:0 0 8px var(--red-glow)}

/* Deposit info card */
.deposit-card{margin:0 16px 16px;padding:20px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-xl)}
.deposit-card .dc-network{display:flex;align-items:center;justify-content:space-between;background:rgba(0,0,0,.3);border:1px solid var(--border);border-radius:10px;padding:10px 12px;margin-bottom:16px}
.dc-network-left{display:flex;align-items:center;gap:8px}
.dc-network .dc-dot{width:8px;height:8px;background:var(--red);border-radius:50%;box-shadow:0 0 6px var(--red);animation:pulse-dot 2s infinite}
@keyframes pulse-dot{0%,100%{opacity:1}50%{opacity:.5}}
.dc-network .dc-name{font-size:13px;font-weight:600}
.dc-network .dc-status{font-size:9px;font-weight:800;text-transform:uppercase;color:var(--red);letter-spacing:1px;border:1px solid rgba(227,30,36,.2);background:rgba(227,30,36,.05);padding:2px 8px;border-radius:4px}
.dc-info{text-align:center;padding:8px 0;font-size:12px;color:var(--dim);margin-bottom:12px}
.dc-info span{color:#fff;font-weight:700}
.dc-address-box{display:flex;align-items:center;gap:6px;background:rgba(0,0,0,.3);border:1px solid var(--border);border-radius:var(--radius);padding:6px 6px 6px 14px}
.dc-address{flex:1;font-family:monospace;font-size:11px;color:var(--dim);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.dc-copy{width:36px;height:36px;border-radius:8px;border:none;background:var(--surface2);color:var(--dim);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s}
.dc-copy:active{background:var(--red);color:#fff}
.dc-copy .material-symbols-outlined{font-size:16px}
.dc-note{display:flex;align-items:flex-start;gap:8px;background:rgba(227,30,36,.04);border:1px solid rgba(227,30,36,.12);border-radius:var(--radius);padding:12px;margin-top:12px}
.dc-note .material-symbols-outlined{font-size:16px;color:var(--red);margin-top:1px;flex-shrink:0}
.dc-note p{font-size:11px;color:var(--dim);line-height:1.5}
.dc-note p span{color:var(--red);font-weight:700}

/* ======================== */
/* === REFERRAL SCREEN === */
/* ======================== */
.ref-hero{margin:16px;border-radius:var(--radius-xl);background:var(--surface);border:1px solid var(--border);padding:28px 20px;text-align:center;position:relative;overflow:hidden}
.ref-hero::before{content:'';position:absolute;top:-60px;right:-40px;width:180px;height:180px;background:radial-gradient(circle,rgba(227,30,36,.12),transparent 70%);border-radius:50%}
.ref-hero::after{content:'';position:absolute;bottom:-40px;left:-40px;width:150px;height:150px;background:radial-gradient(circle,rgba(227,30,36,.08),transparent 70%);border-radius:50%}
.ref-hero-icon{margin-bottom:12px;position:relative;z-index:1;display:flex;align-items:center;justify-content:center}
.ref-hero h1{font-family:'Montserrat',sans-serif;font-size:26px;font-weight:900;margin-bottom:6px;position:relative;z-index:1;letter-spacing:-.5px}
.ref-hero h1 span{color:var(--red)}
.ref-hero p{font-size:13px;color:var(--dim);line-height:1.5;position:relative;z-index:1}
.ref-hero p b{color:#fff}

.ref-link-card{margin:0 16px 16px;padding:2px;border-radius:var(--radius-lg);background:linear-gradient(90deg,rgba(227,30,36,.3),var(--red),rgba(227,30,36,.3));box-shadow:0 0 12px rgba(227,30,36,.15)}
.ref-link-inner{background:var(--surface);border-radius:calc(var(--radius-lg) - 2px);padding:16px}
.ref-link-label{text-align:center;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--dim);margin-bottom:12px}
.ref-link-box{display:flex;align-items:center;gap:6px;background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:4px 4px 4px 12px}
.ref-link-box .ref-url{flex:1;font-size:12px;font-weight:500;color:var(--dim);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.ref-link-box .ref-copy{height:38px;padding:0 16px;border-radius:8px;border:none;background:var(--red);color:#fff;font-family:'Montserrat',sans-serif;font-weight:700;font-size:12px;cursor:pointer;display:flex;align-items:center;gap:6px;transition:all .15s}
.ref-link-box .ref-copy:active{transform:scale(.95)}
.ref-link-box .ref-copy .material-symbols-outlined{font-size:16px}

.ref-stats{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:0 16px;margin-bottom:16px}
.ref-stat-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);padding:16px;display:flex;flex-direction:column;gap:8px;transition:border-color .2s}
.ref-stat-card:hover{border-color:rgba(227,30,36,.2)}
.ref-stat-top{display:flex;justify-content:space-between;align-items:center}
.ref-stat-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center}
.ref-stat-icon .material-symbols-outlined{font-size:18px}
.ref-stat-icon.people{background:rgba(227,30,36,.08);color:var(--red)}
.ref-stat-icon.money{background:rgba(59,130,246,.08);color:var(--blue)}
.ref-stat-badge{font-size:10px;font-weight:700;color:var(--green);background:rgba(34,197,94,.08);padding:2px 8px;border-radius:10px}
.ref-stat-label{font-size:10px;font-weight:600;color:var(--dim)}
.ref-stat-val{font-family:'Montserrat',sans-serif;font-size:24px;font-weight:900;color:#fff}

.ref-how{margin:0 16px 16px}
.ref-how-title{font-family:'Montserrat',sans-serif;font-size:15px;font-weight:800;margin-bottom:12px}
.ref-steps{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);padding:20px}
.ref-step{display:flex;gap:14px;margin-bottom:20px}
.ref-step:last-child{margin-bottom:0}
.ref-step-line{display:flex;flex-direction:column;align-items:center}
.ref-step-num{width:28px;height:28px;border-radius:50%;background:var(--surface2);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-family:'Montserrat',sans-serif;font-size:12px;font-weight:800;color:var(--red);flex-shrink:0}
.ref-step:last-child .ref-step-num{background:var(--red);color:#fff;border:none;box-shadow:0 0 10px var(--red-glow)}
.ref-step-connector{width:1px;flex:1;background:var(--border);margin:4px 0}
.ref-step-content h3{font-size:13px;font-weight:700;color:#fff;margin-bottom:2px}
.ref-step-content p{font-size:11px;color:var(--dim);line-height:1.5}

.ref-share-btn{position:fixed;bottom:calc(var(--nav-h) + 16px);left:50%;transform:translateX(-50%);height:46px;padding:0 28px;border-radius:23px;border:none;background:#fff;color:var(--red);font-family:'Montserrat',sans-serif;font-weight:800;font-size:13px;cursor:pointer;display:flex;align-items:center;gap:8px;box-shadow:0 8px 30px rgba(0,0,0,.5);z-index:40;transition:all .15s}
.ref-share-btn:active{transform:translateX(-50%) scale(.95)}
.ref-share-btn .material-symbols-outlined{font-size:18px}

/* ======================== */
/* === PROFILE SCREEN === */
/* ======================== */
.prof-header{text-align:center;padding:24px 16px 16px}
.prof-avatar{width:80px;height:80px;border-radius:50%;padding:3px;background:var(--red);box-shadow:0 0 16px var(--red-glow);margin:0 auto 12px;display:flex;align-items:center;justify-content:center}
.prof-avatar-inner{width:100%;height:100%;border-radius:50%;background:var(--surface);border:2px solid var(--bg);display:flex;align-items:center;justify-content:center;font-size:32px;overflow:hidden}
.prof-name{font-family:'Montserrat',sans-serif;font-size:22px;font-weight:700;color:#fff;margin-bottom:4px;letter-spacing:-.3px}
.prof-meta{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:16px}
.prof-id{font-size:11px;color:var(--dim);font-family:monospace;letter-spacing:.5px}
.prof-vip-badge{display:flex;align-items:center;gap:4px;font-size:11px;color:var(--red);font-weight:700}
.prof-vip-badge .material-symbols-outlined{font-size:14px}

.prof-level{padding:0 16px;margin-bottom:20px}
.prof-level-top{display:flex;justify-content:space-between;margin-bottom:6px}
.prof-level-name{font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:1px;color:var(--dim);font-family:'Montserrat',sans-serif}
.prof-level-val{font-size:11px;font-weight:600;color:var(--red)}
.prof-level .vip-bar{margin-bottom:4px}
.prof-level-xp{display:flex;justify-content:space-between;font-size:9px;color:var(--dim2)}

.prof-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:0;margin:0 16px 16px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden}
.prof-stat{padding:14px;text-align:center;border-right:1px solid var(--border)}
.prof-stat:last-child{border-right:none}
.prof-stat-label{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--dim);margin-bottom:4px}
.prof-stat-val{font-family:'Montserrat',sans-serif;font-size:18px;font-weight:800;color:#fff}

.prof-referral-btn{margin:0 16px 12px;padding:14px 16px;background:var(--surface);border:1.5px solid rgba(227,30,36,.25);border-radius:var(--radius-lg);display:flex;align-items:center;justify-content:space-between;cursor:pointer;transition:all .15s;box-shadow:0 0 8px rgba(227,30,36,.05)}
.prof-referral-btn:active{background:rgba(227,30,36,.04)}
.prof-ref-left{display:flex;align-items:center;gap:12px}
.prof-ref-icon{width:36px;height:36px;border-radius:50%;background:rgba(227,30,36,.08);border:1px solid rgba(227,30,36,.15);display:flex;align-items:center;justify-content:center}
.prof-ref-icon .material-symbols-outlined{font-size:18px;color:var(--red)}
.prof-ref-text h3{font-size:13px;font-weight:700;color:#fff}
.prof-ref-text p{font-size:10px;color:var(--dim)}
.prof-referral-btn .material-symbols-outlined{color:var(--red);font-size:18px;transition:transform .15s}
.prof-referral-btn:active .material-symbols-outlined:last-child{transform:translateX(2px)}

.prof-menu{margin:0 16px 16px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden}
.prof-menu-item{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .15s}
.prof-menu-item:last-child{border-bottom:none}
.prof-menu-item:active{background:var(--surface2)}
.prof-menu-left{display:flex;align-items:center;gap:12px}
.prof-menu-left .material-symbols-outlined{font-size:20px;color:var(--red)}
.prof-menu-left span:last-child{font-size:13px;font-weight:500}
.prof-menu-item .material-symbols-outlined:last-child{font-size:18px;color:var(--dim2)}

.prof-signout{display:block;margin:0 auto;padding:12px 24px;border:none;background:none;color:var(--dim);font-family:'Montserrat',sans-serif;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:2px;cursor:pointer;transition:color .15s}
.prof-signout:active{color:var(--red)}

/* ======================== */
/* === OVERLAYS === */
/* ======================== */
.bonus-overlay{position:fixed;inset:0;background:rgba(0,0,0,.92);z-index:200;display:none;flex-direction:column;align-items:center;justify-content:center;gap:12px;padding:20px}
.bonus-overlay.show{display:flex}
.bo-title{font-family:'Montserrat',sans-serif;font-size:22px;font-weight:900;color:var(--red);text-shadow:0 0 20px var(--red-glow);animation:bo-pop .5s ease-out}
@keyframes bo-pop{0%{transform:scale(0)}60%{transform:scale(1.2)}100%{transform:scale(1)}}
.bo-info{display:flex;gap:16px}.bo-info-item{text-align:center;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:8px 16px}
.bo-info-item .label{font-size:10px;color:var(--dim)}.bo-info-item .val{font-family:'Montserrat',sans-serif;font-size:18px;font-weight:900;color:var(--gold)}
.bo-grid-wrap{width:100%;max-width:380px;background:rgba(0,0,0,.5);border:2px solid var(--red);border-radius:var(--radius-lg);padding:6px}
.bo-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:3px}
.bo-result{font-weight:800;font-size:18px;color:var(--green);text-align:center;min-height:24px}
.bo-total{font-family:'Montserrat',sans-serif;font-size:28px;font-weight:900;color:var(--gold);text-align:center}
.bo-close{padding:12px 36px;border-radius:var(--radius);border:none;background:var(--red);color:#fff;font-family:'Montserrat',sans-serif;font-weight:900;font-size:15px;cursor:pointer;display:none;box-shadow:0 4px 16px var(--red-glow)}

/* Wheel overlay */
.wheel-overlay{position:fixed;inset:0;background:rgba(0,0,0,.92);z-index:200;display:none;flex-direction:column;align-items:center;justify-content:center;gap:20px;padding:20px}
.wheel-overlay.show{display:flex}
.wo-title{font-family:'Montserrat',sans-serif;font-size:20px;font-weight:900;color:var(--green)}
.wheel-container{position:relative;width:260px;height:260px;margin:0 auto}
.wheel-canvas{width:260px;height:260px;border-radius:50%;transition:transform 4s cubic-bezier(.17,.67,.05,.99)}
.wheel-pointer{position:absolute;top:-8px;left:50%;transform:translateX(-50%);font-size:28px;z-index:10;filter:drop-shadow(0 2px 4px rgba(0,0,0,.5))}
.wheel-center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:44px;height:44px;border-radius:50%;background:var(--red);display:flex;align-items:center;justify-content:center;font-family:'Montserrat',sans-serif;font-weight:900;font-size:14px;color:#fff;box-shadow:0 0 20px var(--red-glow);z-index:5}
.wo-prize{font-family:'Montserrat',sans-serif;font-size:28px;font-weight:900;color:var(--red);min-height:40px}
.wo-btn{padding:14px 40px;border-radius:var(--radius);border:none;background:var(--green);color:#fff;font-family:'Montserrat',sans-serif;font-weight:900;font-size:16px;cursor:pointer}

/* Toast */
.toast{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);background:var(--surface);border:1.5px solid var(--red);border-radius:var(--radius-xl);padding:24px 28px;text-align:center;z-index:500;transition:transform .25s cubic-bezier(.34,1.56,.64,1);max-width:300px;width:85%}
.toast.show{transform:translate(-50%,-50%) scale(1)}
.toast-icon{font-size:40px;margin-bottom:8px}
.toast-text{font-size:14px;font-weight:700;margin-bottom:14px;line-height:1.4}
.toast-btns{display:flex;gap:8px}
.toast-btn{flex:1;padding:10px;border-radius:var(--radius);border:none;font-family:'Montserrat',sans-serif;font-weight:800;font-size:13px;cursor:pointer;transition:transform .1s}
.toast-btn:active{transform:scale(.95)}
.toast-btn.primary{background:var(--red);color:#fff;box-shadow:0 2px 10px var(--red-glow)}
.toast-btn.secondary{background:var(--surface2);color:var(--dim)}

.bomb-pop{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-weight:900;font-size:44px;color:var(--red);z-index:300;pointer-events:none;animation:bp .7s ease-out forwards}
@keyframes bp{0%{transform:translate(-50%,-50%) scale(0);opacity:1}50%{transform:translate(-50%,-50%) scale(1.4);opacity:1}100%{transform:translate(-50%,-60%) scale(1);opacity:0}}
.btn-hover-fx:active{background:rgba(255,255,255,.08)!important;}
</style>
</head>
<body>

<!-- ===== HEADER (shared) ===== -->
<div class="header" id="mainHeader">
    <div class="logo">
        <div class="logo-icon"><span class="material-symbols-outlined">diamond</span></div>
        <div class="logo-text">RUBY<span>BET</span></div>
    </div>
    <div class="header-right">
        <div class="header-bal" onclick="openBalancePopup()"><span id="headerBal">...</span><span class="amt" id="headerUnit">coins</span></div>
        <div class="header-notif"><span class="material-symbols-outlined">notifications</span><div class="dot"></div></div>
    </div>
</div>

<!-- Balance / Currency Popup -->
<div id="balPopup" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;z-index:200">
    <div id="balPopupBg" style="position:absolute;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(4px)" onclick="closeBalancePopup()"></div>
    <div id="balPopupCard" style="position:absolute;top:var(--header-h);right:12px;width:280px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-xl);padding:16px;box-shadow:0 16px 48px rgba(0,0,0,.6);transform:translateY(-8px) scale(.95);opacity:0;transition:all .2s cubic-bezier(.34,1.56,.64,1)">
        <!-- Wallet type toggle -->
        <div style="display:flex;gap:6px;margin-bottom:14px">
            <button class="pill" id="bpUsdt" onclick="switchBalPopup('usdt')" style="flex:1;justify-content:center;height:36px;font-size:12px">üíµ USDT</button>
            <button class="pill" id="bpStars" onclick="switchBalPopup('stars')" style="flex:1;justify-content:center;height:36px;font-size:12px">‚≠ê Stars</button>
        </div>
        <!-- Balance display -->
        <div style="text-align:center;margin-bottom:14px">
            <div style="font-size:9px;font-weight:800;text-transform:uppercase;letter-spacing:1.5px;color:var(--dim);font-family:'Montserrat',sans-serif" id="bpLabel">USDT BALANCE</div>
            <div style="font-family:'Montserrat',sans-serif;font-size:28px;font-weight:900;color:#fff;margin:4px 0" id="bpAmount">$0.00</div>
            <div style="font-size:11px;color:var(--dim)" id="bpSub">‚âà 0.00 USDT</div>
        </div>
        <!-- Currency grid (USDT mode only) -->
        <div id="bpCurrencies" style="display:grid;grid-template-columns:repeat(2,1fr);gap:6px;margin-bottom:14px">
            <button class="pill" data-cur="USD" onclick="setCurrencyPopup('USD')" style="justify-content:center;height:32px;font-size:11px">$ USD</button>
            <button class="pill" data-cur="EUR" onclick="setCurrencyPopup('EUR')" style="justify-content:center;height:32px;font-size:11px">‚Ç¨ EUR</button>
            <button class="pill" data-cur="PLN" onclick="setCurrencyPopup('PLN')" style="justify-content:center;height:32px;font-size:11px">z≈Ç PLN</button>
            <button class="pill" data-cur="UAH" onclick="setCurrencyPopup('UAH')" style="justify-content:center;height:32px;font-size:11px">‚Ç¥ UAH</button>
        </div>
        <!-- Deposit button -->
        <button class="btn-primary" onclick="closeBalancePopup();nav('wallet')" style="height:40px;font-size:12px;border-radius:10px">
            <span class="material-symbols-outlined" style="font-size:16px">add</span>
            <span id="bpDeposit">DEPOSIT</span>
        </button>
    </div>
</div>

<!-- ===== SCREEN: LOBBY ===== -->
<div class="screen active" id="scrLobby">
    <div class="lobby-search" onclick="/* future search */"><span class="material-symbols-outlined">search</span><span id="searchPlaceholder">Search games...</span></div>

    <div class="hero-banner">
        <div class="hero-tag"><span class="material-symbols-outlined">local_fire_department</span><span id="heroTag">HOT</span></div>
        <div class="hero-title" id="heroTitle">RUBY <span class="accent">JACKPOT</span></div>
        <div class="hero-sub" id="heroSub">5,000 coins prize pool</div>
        <div class="hero-actions">
            <button class="hero-btn filled" onclick="nav('game')"><span class="material-symbols-outlined" style="font-size:16px">play_arrow</span><span id="heroPlay">PLAY NOW</span></button>
        </div>
    </div>

    <div class="wheel-banner" id="wheelBanner" onclick="openWheel()">
        <div class="wheel-icon">üé°</div>
        <div class="wheel-info"><h3 id="wheelTitle">Daily Wheel</h3><p id="wheelSub">Spin for free coins!</p></div>
    </div>

    <div class="vip-strip" id="vipStrip">
        <div class="vip-strip-info">
            <div class="vip-strip-top">
                <div class="vip-strip-name"><span id="vipIcon">ü•â</span> <span id="vipName">Bronze</span></div>
                <div class="vip-strip-pct" id="vipPct"></div>
            </div>
            <div class="vip-bar"><div class="vip-bar-fill" id="vipBar" style="width:0%"></div></div>
        </div>
    </div>

    <div class="section"><div class="section-head"><div class="section-title" id="secCat">CATEGORIES</div><div class="section-more" id="secCatMore">VIEW ALL</div></div></div>
    <div class="cat-row" id="catRow"></div>

    <div class="section"><div class="section-head"><div class="section-title"><span style="color:var(--red)">üî•</span> <span id="secTrending">TRENDING NOW</span></div></div></div>
    <div class="game-grid" id="gameGrid"></div>
</div>

<!-- ===== SCREEN: GAME (Ruby Slots) ===== -->
<div class="screen" id="scrGame">
    <div class="game-header">
        <div class="game-back" onclick="nav('lobby')"><span class="material-symbols-outlined">arrow_back</span></div>
        <div class="game-title-bar">RUBY SLOTS</div>
        <div class="game-bal"><span class="material-symbols-outlined">toll</span><span id="gameBal">0</span></div>
    </div>
    <div class="jackpot-display">
        <div class="jackpot-label" id="jackpotLabel">GRAND JACKPOT</div>
        <div class="jackpot-amount">50,000<span>coins</span></div>
    </div>
    <div class="grid-frame" id="gridFrame"><div class="grid" id="grid"></div></div>
    <div class="game-result" id="gameResult"></div>
    <div class="free-spin-badge" id="freeBadge"></div>
    <div class="game-controls">
        <button class="ctrl-side-btn" onclick="toggleAutoSpeed()"><span class="material-symbols-outlined">sync</span><span id="autoLabel">AUTO</span></button>
        <button class="spin-btn m-load" id="spinBtn" onclick="doSpin()"><span class="material-symbols-outlined" id="spinIcon">play_arrow</span><span id="spinTxt">...</span></button>
        <button class="ctrl-side-btn" onclick="setMaxBet()"><span style="font-family:'Montserrat',sans-serif;font-size:14px;font-weight:900">MAX</span><span>MAX</span></button>
    </div>
    <div class="bet-strip">
        <button class="bet-strip-btn" onclick="changeBet(-1)">‚àí</button>
        <div class="bet-strip-val"><span id="betDisplay">5.0</span><span class="bet-unit" id="betUnit">coins</span></div>
        <button class="bet-strip-btn" onclick="changeBet(1)">+</button>
    </div>
    <div class="bet-strip-label" id="betAmountLabel">BET AMOUNT</div>
    <button class="buy-bonus" onclick="buyBonus()">
        <div class="bb-left">üî• <span id="bbLabel">Buy Bonus</span></div>
        <div class="bb-right"><span id="bbPrice">500</span> ü™ô</div>
    </button>
    <!-- speed is toggled via AUTO button now -->
</div>

<!-- ===== SCREEN: BONUSES ===== -->
<div class="screen" id="scrBonuses">
    <div style="padding:16px 16px 8px"><h2 style="font-family:'Montserrat',sans-serif;font-size:22px;font-weight:900" id="bonusTitle">Bonuses</h2></div>
    <div class="pill-row" id="bonusPills"></div>

    <div class="bonus-featured">
        <div style="position:absolute;inset:0;background:url('https://lh3.googleusercontent.com/aida-public/AB6AXuAV67NDOkqHDYuJOwD9Je6tBpmvW3RSI4HF0XkpQdgV_iaaVZYQdnLiQU89PymnRn5IxYBRn0BekcKrZ7NHIYjIugI9wO6OBWtjh95WkV_gWTsuQYmVQBUUNzx_4PBG6K0GmTJ0X4UIHtuR-300bhj-NrT24I4jFK3PVoXbEiArjjbMMNC2Z1gegewHMhPAo6Jv8jx7YoLzIBfS7qP7BZW6Egl5S2nvhVfyUlcT7IWmtAyp3Nmk9-kJ1ey0wszCI9yv8Z5gVji0xsQ') center/cover;opacity:.4"></div>
        <div style="position:absolute;inset:0;background:linear-gradient(to top,#000 0%,rgba(0,0,0,.8) 40%,transparent 100%)"></div>
        <div class="bonus-featured-content">
            <div class="bf-tags">
                <div class="bf-tag" id="bfTag">EXCLUSIVE</div>
                <div class="bf-timer"><span class="material-symbols-outlined">schedule</span><span id="bfTimer">Expires in 24h</span></div>
            </div>
            <div class="bf-title" id="bfTitle">100% Deposit Match</div>
            <div class="bf-desc" id="bfDesc">Get up to 1 BTC on your first deposit. Double your playing money instantly.</div>
            <div class="bf-bottom">
                <div><div class="bf-wager-label" id="bfWagerL">WAGER</div><div class="bf-wager-val">x30</div></div>
                <button class="bf-activate" onclick="nav('wallet')"><span id="bfActivate">Activate</span><span class="material-symbols-outlined">arrow_forward</span></button>
            </div>
        </div>
    </div>

    <div class="bonus-card" id="bonusCard1">
        <div class="bonus-card-img" style="background:url('https://lh3.googleusercontent.com/aida-public/AB6AXuCGPEWfXzJNFUB_EXtz51yNIgZjSz3ob9Sd6-OvSGCEov_UGnbjxRwxMthy3MaZd1y3sSKFQxwzinGVFSSUX6MX9LyQcbKOBjS5_h1pMDeP_qC8HgHFFIgVYK41U0IvGrywNBdnYg_6F9KYsRPzmehtL1exPYlIBqyl0I_OSqEwsbDA2rCwRGfu5u_cfHLtbQ7-BRMS0J7mw0JvhGp8lvR9IZ4OtqySVweNv6ohZpAhMhQlsEN84latpHmJh9r7dfdWo9zYOsB4JI0') center/cover"></div>
        <div class="bonus-card-body">
            <div class="bonus-card-title" id="bc1Title">50 Free Spins</div>
            <div class="bonus-card-desc" id="bc1Desc">Valid for Ruby Slots. No deposit required for new players.</div>
            <button class="bonus-card-btn" id="bc1Btn">Claim Now</button>
        </div>
    </div>

    <div class="bonus-card" id="bonusCard2">
        <div class="bonus-card-img" style="background:url('https://lh3.googleusercontent.com/aida-public/AB6AXuDaEolN36F7I9DO5xzDpZJT44gKy0UqcrJkYSpxyvjhw60tyAD7Gy1Bh8-CCjn0wUqGk1dsU3gdG_wlCSodYaiglPb9p8QgUqGUehCxqDwVJx93ersDjvbFa3lgxVwIN2gd29K0ZxblLEP1EkgNZjgTh-fyy3QTKfOvEz8y3gytYBMe2jAJiNryHDsJPpexYxJRkJes_Fb1dmeQ8JqtUOssDqpIUiDNt9FwWXyXoN3at4S1zDC3DhMbXR_TZYjG8VkEpKZFQ2t4ucw') center/cover"></div>
        <div class="bonus-card-body">
            <div class="bonus-card-title" id="bc2Title">Weekly Cashback</div>
            <div class="bonus-card-desc" id="bc2Desc">Get 10% back on all losses every Monday. VIP tiers get up to 20%.</div>
            <button class="bonus-card-btn" id="bc2Btn">Join Club</button>
        </div>
    </div>

    <div class="bonus-locked" style="position:relative">
        <div style="width:33%;min-height:100px;background:url('https://lh3.googleusercontent.com/aida-public/AB6AXuB75EFJ8WIHV-d3TCC0alchWDHTnjGNxWnlJ-CXg6bUaiLzn5to-juivqE1pzeF5TptEeGKwMiKm5NxX5ceNXqUF8x0mTtKAGfHxwEB7-N6TDbNSBxzgVPMLvcPL-WfAIfpJ7o2OL92a__p0S8W_kps90q9TiQ29-7BWlUNCnuZz77-TLZDCiNaUpGKDAs2Tg67FuFyipOljK3xuYXjy0Ak2HIjQODAxVnZH8zc-AO4k8AV6WfqGNcUV0aOMUDJQ77HTwTifyNSP3Y') center/cover;filter:grayscale(1);flex-shrink:0"></div>
        <div class="lock-icon"><span class="material-symbols-outlined">lock</span></div>
        <div class="bonus-locked-body">
            <div class="bl-title" id="blTitle">Diamond VIP Status</div>
            <div class="bl-desc" id="blDesc">Unlock exclusive tournaments.</div>
            <div class="bl-progress"><div class="bl-progress-fill" style="width:45%"></div></div>
            <div class="bl-progress-label">Level 4/10</div>
        </div>
    </div>
</div>
<!-- ===== SCREEN: WALLET ===== -->
<div class="screen" id="scrWallet">
    <!-- Balance switcher: USDT / Stars -->
    <div style="display:flex;gap:8px;padding:12px 16px 4px">
        <button class="pill active" id="walTabUsdt" onclick="switchWalletTab('usdt')" style="flex:1;justify-content:center">üíµ USDT</button>
        <button class="pill" id="walTabStars" onclick="switchWalletTab('stars')" style="flex:1;justify-content:center">‚≠ê Stars</button>
    </div>

    <!-- USDT balance -->
    <div id="walUsdt">
        <div class="wallet-balance">
            <div class="wallet-balance-label" id="wBalLabel">TOTAL BALANCE</div>
            <div class="wallet-balance-amount">
                <h1 id="wBalAmount">0.00</h1>
                <div class="unit" id="wBalUnit">USDT</div>
            </div>
            <div style="font-size:12px;color:var(--dim);margin-top:2px" id="wBalLocal"></div>
        </div>
        <!-- Currency display switcher -->
        <div style="display:flex;gap:6px;padding:0 16px 12px;justify-content:center;flex-wrap:wrap" id="currencyRow">
            <button class="pill active" onclick="setCurrency('USDT')" data-cur="USDT" style="font-size:11px;height:28px;padding:0 12px">USDT</button>
            <button class="pill" onclick="setCurrency('USD')" data-cur="USD" style="font-size:11px;height:28px;padding:0 12px">USD</button>
            <button class="pill" onclick="setCurrency('PLN')" data-cur="PLN" style="font-size:11px;height:28px;padding:0 12px">PLN</button>
            <button class="pill" onclick="setCurrency('UAH')" data-cur="UAH" style="font-size:11px;height:28px;padding:0 12px">UAH</button>
            <button class="pill" onclick="setCurrency('EUR')" data-cur="EUR" style="font-size:11px;height:28px;padding:0 12px">EUR</button>
        </div>

        <div class="wallet-actions">
            <button class="btn-primary" onclick="openDepositModal('usdt')"><span class="material-symbols-outlined" style="font-size:18px">arrow_downward</span><span id="wDeposit">DEPOSIT</span></button>
            <button class="btn-outline" style="color:var(--red)"><span class="material-symbols-outlined" style="font-size:18px">arrow_upward</span><span id="wWithdraw">WITHDRAW</span></button>
        </div>

        <button class="wallet-history-btn"><span class="material-symbols-outlined">history</span><span id="wHistory">View Transaction History</span></button>

        <!-- Payment methods -->
        <div class="section" style="margin-top:8px"><div class="section-head"><div class="section-title" id="wMethodLabel">PAYMENT METHOD</div></div></div>
        <div style="display:flex;flex-direction:column;gap:8px;padding:0 16px;margin-bottom:16px">
            <button class="card" style="display:flex;align-items:center;gap:12px;padding:14px 16px;cursor:pointer;border:1.5px solid var(--red);transition:all .15s" id="pmCrypto" onclick="selectPayMethod('crypto')">
                <div style="width:40px;height:40px;border-radius:10px;background:rgba(227,30,36,.08);display:flex;align-items:center;justify-content:center;flex-shrink:0"><span style="font-size:20px">üíé</span></div>
                <div style="flex:1"><div style="font-size:13px;font-weight:700">CryptoBot</div><div style="font-size:10px;color:var(--dim)">USDT, BTC, TON</div></div>
                <span class="material-symbols-outlined" style="color:var(--red);font-size:18px">check_circle</span>
            </button>
            <button class="card" style="display:flex;align-items:center;gap:12px;padding:14px 16px;cursor:pointer;transition:all .15s" id="pmCard" onclick="selectPayMethod('card')">
                <div style="width:40px;height:40px;border-radius:10px;background:rgba(59,130,246,.08);display:flex;align-items:center;justify-content:center;flex-shrink:0"><span style="font-size:20px">üí≥</span></div>
                <div style="flex:1"><div style="font-size:13px;font-weight:700" id="pmCardTitle">Bank Card</div><div style="font-size:10px;color:var(--dim)">Visa, Mastercard</div></div>
                <span class="material-symbols-outlined" style="color:var(--dim);font-size:18px" id="pmCardCheck">radio_button_unchecked</span>
            </button>
        </div>

        <!-- Deposit packages -->
        <div class="wallet-assets">
            <div class="wallet-assets-label" id="wPkgLabel">SELECT PACKAGE</div>
            <div class="asset-row" id="assetRow" style="display:grid;"></div>
        </div>
    </div>

    <!-- Stars balance -->
    <div id="walStars" style="display:none">
        <div class="wallet-balance">
            <div class="wallet-balance-label">‚≠ê STARS BALANCE</div>
            <div class="wallet-balance-amount">
                <h1 id="wStarsAmount">0</h1>
                <div class="unit" style="color:#FFD700">Stars</div>
            </div>
        </div>

        <div class="wallet-actions">
            <button class="btn-primary" style="background:#FFD700;color:#000;box-shadow:0 4px 16px rgba(255,215,0,.3)" onclick="openDepositModal('stars')"><span class="material-symbols-outlined" style="font-size:18px">star</span><span>BUY STARS</span></button>
        </div>

        <div style="padding:0 16px;margin-top:8px">
            <div class="dc-note">
                <span class="material-symbols-outlined">info</span>
                <p id="starsNote">Stars are purchased via Telegram and can be used to play separately. Stars balance is independent from USDT.</p>
            </div>
        </div>

        <!-- Stars packages -->
        <div class="wallet-assets" style="margin-top:16px">
            <div class="wallet-assets-label">SELECT STARS PACKAGE</div>
            <div class="asset-row" id="starsRow" style="display:grid;"></div>
        </div>
    </div>
</div>

<!-- ===== SCREEN: REFERRAL ===== -->
<div class="screen" id="scrReferral">
    <div class="ref-hero">
        <div class="ref-hero-icon"><img src="https://lh3.googleusercontent.com/aida-public/AB6AXuCpCm-In3qaads4-907wOGoyxZRtNhNrOWD-U1kAC57uAA0oO3DnPwchxZ4EraGR6QuJgvoSYkYmuPig3Bi5g-ROCe5cnWc_zg4Jis0UHe8n3saeShVPK2gJ4DXrXcOK-M2IjhFYujSo3fc2HFsdKyGllktDw2yiUFcLx0VlGohAFPIZdJjzEn-_bw47k35CYqzdnl6tKITBGL_Jdj7BNOqIkQ5uK71RWcXAWNxEJtmUIMLeNmbVOuLBo45VWiYk9VAWFqJvWBhpeY" alt="Coins" style="width:100px;height:100px;object-fit:contain;filter:drop-shadow(0 8px 16px rgba(227,30,36,.3))"></div>
        <h1 id="refHeroTitle">Invite & <span>Earn</span></h1>
        <p id="refHeroDesc">Share your link and earn <b>10 coins</b> for every friend who plays.</p>
    </div>

    <div class="ref-link-card">
        <div class="ref-link-inner">
            <div class="ref-link-label" id="refLinkLabel">TAP COPY TO SHARE</div>
            <div class="ref-link-box">
                <div class="ref-url" id="refUrl">https://t.me/bot?start=ref...</div>
                <button class="ref-copy" onclick="copyRefLink()"><span class="material-symbols-outlined">content_copy</span><span id="refCopyText">Copy</span></button>
            </div>
        </div>
    </div>

    <div class="ref-stats">
        <div class="ref-stat-card">
            <div class="ref-stat-top">
                <div class="ref-stat-icon people"><span class="material-symbols-outlined">group_add</span></div>
                <div class="ref-stat-badge" id="refNewBadge"></div>
            </div>
            <div class="ref-stat-label" id="refTotalLabel">Total Referrals</div>
            <div class="ref-stat-val" id="refTotalVal">0</div>
        </div>
        <div class="ref-stat-card">
            <div class="ref-stat-top">
                <div class="ref-stat-icon money"><span class="material-symbols-outlined">account_balance_wallet</span></div>
            </div>
            <div class="ref-stat-label" id="refEarnedLabel">Earned Coins</div>
            <div class="ref-stat-val" id="refEarnedVal">0</div>
        </div>
    </div>

    <div class="ref-how">
        <div class="ref-how-title" id="refHowTitle">How it Works</div>
        <div class="ref-steps">
            <div class="ref-step"><div class="ref-step-line"><div class="ref-step-num">1</div><div class="ref-step-connector"></div></div><div class="ref-step-content"><h3 id="refStep1T">Share with friends</h3><p id="refStep1D">Send your unique link via Telegram or social media.</p></div></div>
            <div class="ref-step"><div class="ref-step-line"><div class="ref-step-num">2</div><div class="ref-step-connector"></div></div><div class="ref-step-content"><h3 id="refStep2T">Friends start playing</h3><p id="refStep2D">When they register, you both get bonus coins.</p></div></div>
            <div class="ref-step"><div class="ref-step-line"><div class="ref-step-num">3</div></div><div class="ref-step-content"><h3 id="refStep3T">Earn Rewards</h3><p id="refStep3D">Get 10 coins for every friend who joins.</p></div></div>
        </div>
    </div>

    <button class="ref-share-btn" onclick="shareRef()"><span class="material-symbols-outlined">ios_share</span><span id="refShareBtn">Share Link Now</span></button>
</div>

<!-- ===== SCREEN: PROFILE ===== -->
<div class="screen" id="scrProfile">
    <div class="prof-header">
        <div class="prof-avatar"><div class="prof-avatar-inner" id="profAvatarInner"><img src="https://lh3.googleusercontent.com/aida-public/AB6AXuDr3zsmMzZoKQBmXyKeYm7wjdUyCdTgqgmWcGFJrHZ1j04p23PyhyC-veLVchduXKVpILhD8OvgoBIY1kOdWCDOIZgRURbE4kJTa5KugjgI2XTZ2f-Atab5Y1nG3egXh_6wk1yFwzjlyBkkbJ3ID-hqkVSJfimD4Exhl70tk5RZYzwUAQXuY1t0RWIhqsrPPWPeni-TFGVUKHJ7X0JKR0ANZAZXV9wWgMeBNnOzlApLWWe8wo3HJ13XCqJvvsTxAsyt3XT5UdULBhM" alt="Avatar" style="width:100%;height:100%;object-fit:cover"></div></div>
        <div class="prof-name" id="profName">Player</div>
        <div class="prof-meta">
            <span class="prof-id" id="profId">ID: ...</span>
            <span style="width:1px;height:14px;background:var(--surface2)"></span>
            <span class="prof-vip-badge"><span class="material-symbols-outlined">stars</span><span id="profVipBadge">VIP</span></span>
        </div>
    </div>

    <div class="prof-level">
        <div class="prof-level-top">
            <div class="prof-level-name" id="profLevelName">Bronze</div>
            <div class="prof-level-val" id="profLevelVal">Level 1</div>
        </div>
        <div class="vip-bar"><div class="vip-bar-fill" id="profVipBar" style="width:0%"></div></div>
        <div class="prof-level-xp"><span id="profXpLabel">Current XP</span><span id="profXpVal">0 / 1000</span></div>
    </div>

    <div class="prof-stats">
        <div class="prof-stat"><div class="prof-stat-label" id="stWinsL">WINS</div><div class="prof-stat-val" id="stWins">0</div></div>
        <div class="prof-stat"><div class="prof-stat-label" id="stLossesL">LOSSES</div><div class="prof-stat-val" id="stLosses">0</div></div>
        <div class="prof-stat"><div class="prof-stat-label" id="stTotalL">TOTAL</div><div class="prof-stat-val" id="stTotal">0</div></div>
    </div>

    
    <!-- MY BONUSES BLOCK IN PROFILE -->
    <div style="margin: 0 16px 16px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg); overflow: hidden;">
        <div style="padding: 16px; border-bottom: 1px solid rgba(255,255,255,.05); display: flex; justify-content: space-between; align-items: center;">
            <div style="font-family: 'Montserrat',sans-serif; font-size: 14px; font-weight: 800; color: #fff;">My Bonuses</div>
            <div style="font-size: 11px; font-weight: 700; color: var(--red);" id="activeBonusCountProf">0 Active</div>
        </div>
        <div style="padding: 16px; text-align: center; background: radial-gradient(ellipse at center, rgba(227,30,36,.1) 0%, transparent 80%);">
            <div style="font-size: 10px; font-weight: 800; text-transform: uppercase; color: var(--dim2); margin-bottom: 4px;">Bonus Balance</div>
            <div style="font-family: 'Montserrat',sans-serif; font-size: 28px; font-weight: 900; color: #fff; margin-bottom: 12px;" id="bonusBalAmountProf">$0.00</div>
            <div id="profBonusList" style="display:flex; flex-direction:column; gap:8px; text-align:left;"></div>
        </div>
        <button onclick="nav('bonuses')" style="width:100%; padding:14px; background:rgba(255,255,255,.03); border:none; border-top:1px solid var(--border); color:var(--dim); font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:1px; cursor:pointer;" class="btn-hover-fx">View All Bonuses <span class="material-symbols-outlined" style="font-size:14px; vertical-align:middle;">arrow_forward</span></button>
    </div>

    <div class="prof-referral-btn" onclick="nav('referral')">
        <div class="prof-ref-left">
            <div class="prof-ref-icon"><span class="material-symbols-outlined">diversity_3</span></div>
            <div class="prof-ref-text"><h3 id="profRefTitle">Referral Program</h3><p id="profRefSub">Invite friends & earn rewards</p></div>
        </div>
        <span class="material-symbols-outlined">arrow_forward</span>
    </div>

    <div class="prof-menu">
        <div class="prof-menu-item" onclick="openLangSelector()"><div class="prof-menu-left"><span class="material-symbols-outlined">language</span><span id="profLang">Language</span></div><div style="display:flex;align-items:center;gap:4px"><span id="profLangCurrent" style="font-size:12px;color:var(--dim)"></span><span class="material-symbols-outlined">chevron_right</span></div></div>
        <div class="prof-menu-item" onclick="changeLang()"><div class="prof-menu-left"><span class="material-symbols-outlined">settings</span><span id="profSettings">Settings</span></div><span class="material-symbols-outlined">chevron_right</span></div>
        <div class="prof-menu-item"><div class="prof-menu-left"><span class="material-symbols-outlined">security</span><span id="profSecurity">Security</span></div><span class="material-symbols-outlined">chevron_right</span></div>
        <div class="prof-menu-item"><div class="prof-menu-left"><span class="material-symbols-outlined">headset_mic</span><span id="profSupport">Support</span></div><span class="material-symbols-outlined">chevron_right</span></div>
    </div>

    <!-- Language selector overlay -->
    <div id="langOverlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:300;align-items:flex-end;justify-content:center">
        <div style="background:var(--surface);border-top-left-radius:var(--radius-xl);border-top-right-radius:var(--radius-xl);width:100%;max-width:480px;padding:20px 16px 32px">
            <div style="width:40px;height:4px;background:var(--surface3);border-radius:2px;margin:0 auto 16px"></div>
            <h3 style="font-family:'Montserrat',sans-serif;font-size:16px;font-weight:800;margin-bottom:16px;text-align:center" id="langTitle">Select Language</h3>
            <div style="display:flex;flex-direction:column;gap:6px" id="langList"></div>
        </div>
    </div>

    <button class="prof-signout" id="profSignout">Sign Out</button>
</div>

<!-- ===== BOTTOM NAV ===== -->
<div class="bottom-nav">
    <div class="nav-item active" data-screen="lobby" onclick="nav('lobby')"><span class="material-symbols-outlined">home</span><div class="nav-label" id="navLobby">Home</div></div>
    <div class="nav-item" data-screen="game" onclick="nav('game')"><span class="material-symbols-outlined">casino</span><div class="nav-label" id="navGame">Games</div></div>
    <div class="nav-item" data-screen="bonuses" onclick="nav('bonuses')"><span class="material-symbols-outlined">redeem</span><div class="nav-label" id="navBonuses">Bonuses</div></div>
    <div class="nav-item" data-screen="wallet" onclick="nav('wallet')"><span class="material-symbols-outlined">account_balance_wallet</span><div class="nav-label" id="navWallet">Wallet</div></div>
    <div class="nav-item" data-screen="profile" onclick="nav('profile')"><span class="material-symbols-outlined">person</span><div class="nav-label" id="navProfile">Profile</div></div>
</div>

<!-- ===== BONUS OVERLAY ===== -->
<div class="bonus-overlay" id="bonusOL">
    <div class="bo-title" id="boTitle">üé∞ BONUS ROUND üé∞</div>
    <div class="bo-info"><div class="bo-info-item"><div class="label" id="boSpinL">SPIN</div><div class="val" id="boSpinC">0/10</div></div><div class="bo-info-item"><div class="label" id="boTotalL">WIN</div><div class="val" id="boRunT">0</div></div></div>
    <div class="bo-grid-wrap"><div class="bo-grid" id="boGrid"></div></div>
    <div class="bo-result" id="boRes"></div>
    <div class="bo-total" id="boFinal"></div>
    <button class="bo-close" id="boClose" onclick="closeBonus()">COLLECT ü™ô</button>
</div>

<!-- ===== TOAST ===== -->
<div class="toast" id="toast">
    <div class="toast-icon" id="toastIcon">üí∞</div>
    <div class="toast-text" id="toastText">Not enough coins!</div>
    <div class="toast-btns">
        <button class="toast-btn secondary" onclick="closeToast()" id="toastCancel">‚úï</button>
        <button class="toast-btn primary" onclick="toastAction()" id="toastOk">Deposit</button>
    </div>
</div>

<!-- ===== WHEEL OVERLAY ===== -->
<div class="wheel-overlay" id="wheelOL">
    <div class="wo-title" id="woTitle">üé° Daily Wheel</div>
    <div class="wheel-container">
        <div class="wheel-pointer">‚ñº</div>
        <canvas class="wheel-canvas" id="wheelCanvas" width="260" height="260"></canvas>
        <div class="wheel-center">GO</div>
    </div>
    <div class="wo-prize" id="woPrize"></div>
    <button class="wo-btn" id="woBtn" onclick="spinWheel()">SPIN!</button>
</div>

<script>
/* ================================================================
   RubyBet Mini App ‚Äî Full JS (preserving all original game logic)
   ================================================================ */
const tg=window.Telegram.WebApp;tg.ready();tg.expand();
try{tg.setHeaderColor('#121212');tg.setBackgroundColor('#121212')}catch(e){}
const P=new URLSearchParams(location.search);
const API=P.get('api')||"https://lucky-slots-production.up.railway.app";
const BOT=P.get('bot')||"testplcas_bot";
const LANG=P.get('lang')||'en';
const UID=P.get('uid')||'';
const TOK=P.get('token')||'';

/* === LOCALIZATION === */
const LC={
pl:{home:"Home",games:"Gry",bonuses:"Bonusy",wallet:"Portfel",profile:"Profil",spin:"ZAKRƒòƒÜ",deposit:"DEPOZYT",searchPlaceholder:"Szukaj gier...",categories:"KATEGORIE",viewAll:"ZOBACZ WSZYSTKO",trending:"NA TOPIE",playNow:"GRAJ TERAZ",hot:"GORƒÑCE",heroTitle:"RUBY JACKPOT",heroSub:"5,000 ≈ºeton√≥w w puli nagr√≥d",wheel:"Ko≈Ço Dnia",wheelSub:"Krƒôƒá za darmowe monety!",wheelSpin:"KRƒòƒÜ!",collect:"ODBIERZ",bonusRound:"üé∞ RUNDA BONUSOWA üé∞",spinL:"SPIN",winL:"WYGRANA",buyBonus:"Kup Bonus",slotName:"Ruby Slots",slotTag:"GORƒÑCE",crashName:"Crash",diceName:"Ko≈õci",mineName:"Miny",coinName:"Coin Flip",rouletteName:"Ruletka",blackjackName:"Blackjack",comingTag:"WKR√ìTCE",freeSpins:"Darmowe spiny",noMoney:"Brak ≈õrodk√≥w!",noMoneyDesc:"Do≈Çaduj konto ≈ºeby kontynuowaƒá grƒô",depositBtn:"Do≈Çaduj",cancelBtn:"Anuluj",lose:"Brak wygranej",win:"WYGRANA",totalBalance:"≈ÅƒÑCZNY BALANS",withdraw:"WYP≈ÅATA",transHistory:"Historia transakcji",selectPkg:"WYBIERZ PAKIET",bonusTitle:"Bonusy",exclusive:"EKSKLUZYWNE",bfTitle:"100% Bonus od Depozytu",bfDesc:"Podw√≥j swojƒÖ pierwszƒÖ wp≈Çatƒô. Natychmiastowe dodanie.",bfTimer:"Wygasa za 24h",wager:"STAWKA",activate:"Aktywuj",freeSpinsTitle:"50 Darmowych Spin√≥w",freeSpinsDesc:"Do Ruby Slots. Bez depozytu dla nowych graczy.",claimNow:"Odbierz",cashbackTitle:"Tygodniowy Cashback",cashbackDesc:"Odbierz 10% zwrotu co poniedzia≈Çek. VIP do 20%.",joinClub:"Do≈ÇƒÖcz",vipTitle:"Diamentowy VIP",vipDesc:"Odblokuj ekskluzywne turnieje.",inviteEarn:"Zapro≈õ i Zarabiaj",inviteDesc:"Podziel siƒô linkiem i zdobƒÖd≈∫ 10 ≈ºeton√≥w za ka≈ºdego znajomego.",tapCopy:"NACI≈öNIJ ABY SKOPIOWAƒÜ",copy:"Kopiuj",totalRefs:"Zaproszonych",earnedCoins:"Zarobione ≈ºetony",howItWorks:"Jak to dzia≈Ça",step1T:"Podziel siƒô ze znajomymi",step1D:"Wy≈õlij link przez Telegram lub social media.",step2T:"Znajomi zaczynajƒÖ graƒá",step2D:"Gdy siƒô zarejestrujƒÖ, obaj dostajecie bonus.",step3T:"Zbieraj Nagrody",step3D:"Otrzymaj 10 ≈ºeton√≥w za ka≈ºdego zaproszonego.",shareNow:"Udostƒôpnij Link",wins:"WYGRANE",losses:"PRZEGRANE",total:"≈ÅƒÑCZNIE",referralProgram:"Program PolecajƒÖcy",inviteFriends:"Zapro≈õ znajomych i zarabiaj",settings:"Ustawienia",security:"Bezpiecze≈Ñstwo",support:"Pomoc",signOut:"Wyloguj",currentXp:"Aktualne XP",level:"Poziom",slots:"Sloty",live:"Na ≈ºywo",crash:"Crash",table:"Sto≈Çowe",jackpotLabel:"WIELKA JACKPOT",grandJackpot:"GRAND JACKPOT",coins:"≈ºeton√≥w"},
ua:{home:"–î–æ–ºi–≤",games:"–Ü–≥—Ä–∏",bonuses:"–ë–æ–Ω—É—Å–∏",wallet:"–ì–∞–º–∞–Ω–µ—Ü—å",profile:"–ü—Ä–æ—Ñ—ñ–ª—å",spin:"–ì–†–ê–¢–ò",deposit:"–î–ï–ü–û–ó–ò–¢",searchPlaceholder:"–ü–æ—à—É–∫ —ñ–≥–æ—Ä...",categories:"–ö–ê–¢–ï–ì–û–†–Ü–á",viewAll:"–ë–ê–ß–ò–¢–ò –í–°–ï",trending:"–í –¢–†–ï–ù–î–Ü",playNow:"–ì–†–ê–¢–ò –ó–ê–†–ê–ó",hot:"–ì–ê–†–Ø–ß–ï",heroTitle:"RUBY JACKPOT",heroSub:"5,000 –∂–µ—Ç–æ–Ω—ñ–≤ —É –ø—Ä–∏–∑–æ–≤–æ–º—É –ø—É–ª—ñ",wheel:"–ö–æ–ª–µ—Å–æ –î–Ω—è",wheelSub:"–ö—Ä—É—Ç–∏ –∑–∞ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ –º–æ–Ω–µ—Ç–∏!",wheelSpin:"–ö–†–£–¢–ò!",collect:"–ó–ê–ë–†–ê–¢–ò",bonusRound:"üé∞ –ë–û–ù–£–° –†–ê–£–ù–î üé∞",spinL:"–°–ü–Ü–ù",winL:"–í–ò–ì–†–ê–®",buyBonus:"–ö—É–ø–∏—Ç–∏ –ë–æ–Ω—É—Å",slotName:"Ruby Slots",slotTag:"–ì–ê–†–Ø–ß–ï",crashName:"Crash",diceName:"–ö–æ—Å—Ç—ñ",mineName:"–ú—ñ–Ω–∏",coinName:"–ú–æ–Ω–µ—Ç–∫–∞",rouletteName:"–†—É–ª–µ—Ç–∫–∞",blackjackName:"–ë–ª–µ–∫–¥–∂–µ–∫",comingTag:"–ù–ï–ó–ê–ë–ê–†–û–ú",freeSpins:"–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ —Å–ø—ñ–Ω–∏",noMoney:"–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤!",noMoneyDesc:"–ü–æ–ø–æ–≤–Ω—ñ—Ç—å —Ä–∞—Ö—É–Ω–æ–∫",depositBtn:"–ü–æ–ø–æ–≤–Ω–∏—Ç–∏",cancelBtn:"–°–∫–∞—Å—É–≤–∞—Ç–∏",lose:"–ë–µ–∑ –≤–∏–≥—Ä–∞—à—É",win:"–í–ò–ì–†–ê–®",totalBalance:"–ó–ê–ì–ê–õ–¨–ù–ò–ô –ë–ê–õ–ê–ù–°",withdraw:"–í–ò–í–ï–°–¢–ò",transHistory:"–Ü—Å—Ç–æ—Ä—ñ—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π",selectPkg:"–û–ë–ï–†–Ü–¢–¨ –ü–ê–ö–ï–¢",bonusTitle:"–ë–æ–Ω—É—Å–∏",exclusive:"–ï–ö–°–ö–õ–Æ–ó–ò–í–ù–û",bfTitle:"100% –ë–æ–Ω—É—Å –Ω–∞ –î–µ–ø–æ–∑–∏—Ç",bfDesc:"–ü–æ–¥–≤—ñ–π—Ç–µ —Å–≤—ñ–π –ø–µ—Ä—à–∏–π –¥–µ–ø–æ–∑–∏—Ç.",bfTimer:"–ó–∞–∫—ñ–Ω—á—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ 24–≥",wager:"–°–¢–ê–í–ö–ê",activate:"–ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏",freeSpinsTitle:"50 –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏—Ö –°–ø—ñ–Ω—ñ–≤",freeSpinsDesc:"–î–ª—è Ruby Slots. –ë–µ–∑ –¥–µ–ø–æ–∑–∏—Ç—É –¥–ª—è –Ω–æ–≤–∏—Ö –≥—Ä–∞–≤—Ü—ñ–≤.",claimNow:"–û—Ç—Ä–∏–º–∞—Ç–∏",cashbackTitle:"–©–æ—Ç–∏–∂–Ω–µ–≤–∏–π –ö–µ—à–±–µ–∫",cashbackDesc:"–û—Ç—Ä–∏–º–∞–π—Ç–µ 10% –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è —â–æ–ø–æ–Ω–µ–¥—ñ–ª–∫–∞.",joinClub:"–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è",vipTitle:"–î—ñ–∞–º–∞–Ω—Ç–æ–≤–∏–π VIP",vipDesc:"–†–æ–∑–±–ª–æ–∫—É–π—Ç–µ –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω—ñ —Ç—É—Ä–Ω—ñ—Ä–∏.",inviteEarn:"–ó–∞–ø—Ä–æ—à—É–π —Ç–∞ –ó–∞—Ä–æ–±–ª—è–π",inviteDesc:"–ü–æ–¥—ñ–ª–∏—Å—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º —Ç–∞ –æ—Ç—Ä–∏–º–∞–π 10 –∂–µ—Ç–æ–Ω—ñ–≤ –∑–∞ –∫–æ–∂–Ω–æ–≥–æ –¥—Ä—É–≥–∞.",tapCopy:"–ù–ê–¢–ò–°–ù–Ü–¢–¨ –©–û–ë–ò –°–ö–û–ü–Ü–Æ–í–ê–¢–ò",copy:"–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏",totalRefs:"–ó–∞–ø—Ä–æ—à–µ–Ω–æ",earnedCoins:"–ó–∞—Ä–æ–±–ª–µ–Ω–æ –∂–µ—Ç–æ–Ω—ñ–≤",howItWorks:"–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î",step1T:"–ü–æ–¥—ñ–ª–∏—Å—å –∑ –¥—Ä—É–∑—è–º–∏",step1D:"–í—ñ–¥–ø—Ä–∞–≤ –ø–æ—Å–∏–ª–∞–Ω–Ω—è —á–µ—Ä–µ–∑ Telegram.",step2T:"–î—Ä—É–∑—ñ –ø–æ—á–∏–Ω–∞—é—Ç—å –≥—Ä–∞—Ç–∏",step2D:"–ö–æ–ª–∏ –≤–æ–Ω–∏ –∑–∞—Ä–µ—î—Å—Ç—Ä—É—é—Ç—å—Å—è, –æ–±–∏–¥–≤–∞ –æ—Ç—Ä–∏–º–∞—é—Ç—å –±–æ–Ω—É—Å.",step3T:"–ó–±–∏—Ä–∞–π –ù–∞–≥–æ—Ä–æ–¥–∏",step3D:"–û—Ç—Ä–∏–º–∞–π 10 –∂–µ—Ç–æ–Ω—ñ–≤ –∑–∞ –∫–æ–∂–Ω–æ–≥–æ.",shareNow:"–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è",wins:"–í–ò–ì–†–ê–®–Ü",losses:"–ü–†–û–ì–†–ê–®–Ü",total:"–í–°–¨–û–ì–û",referralProgram:"–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞ –ü—Ä–æ–≥—Ä–∞–º–∞",inviteFriends:"–ó–∞–ø—Ä–æ—à—É–π –¥—Ä—É–∑—ñ–≤ —Ç–∞ –∑–∞—Ä–æ–±–ª—è–π",settings:"–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è",security:"–ë–µ–∑–ø–µ–∫–∞",support:"–ü—ñ–¥—Ç—Ä–∏–º–∫–∞",signOut:"–í–∏–π—Ç–∏",currentXp:"–ü–æ—Ç–æ—á–Ω–∏–π XP",level:"–†—ñ–≤–µ–Ω—å",slots:"–°–ª–æ—Ç–∏",live:"–õ–∞–π–≤",crash:"Crash",table:"–°—Ç–æ–ª–∏",jackpotLabel:"–í–ï–õ–ò–ö–ò–ô –î–ñ–ï–ö–ü–û–¢",grandJackpot:"GRAND JACKPOT",coins:"–∂–µ—Ç–æ–Ω—ñ–≤"},
ru:{home:"–ì–ª–∞–≤–Ω–∞—è",games:"–ò–≥—Ä—ã",bonuses:"–ë–æ–Ω—É—Å—ã",wallet:"–ö–æ—à–µ–ª—ë–∫",profile:"–ü—Ä–æ—Ñ–∏–ª—å",spin:"–ò–ì–†–ê–¢–¨",deposit:"–î–ï–ü–û–ó–ò–¢",searchPlaceholder:"–ü–æ–∏—Å–∫ –∏–≥—Ä...",categories:"–ö–ê–¢–ï–ì–û–†–ò–ò",viewAll:"–í–°–ï",trending:"–í –¢–†–ï–ù–î–ï",playNow:"–ò–ì–†–ê–¢–¨",hot:"–ì–û–†–Ø–ß–ï–ï",heroTitle:"RUBY JACKPOT",heroSub:"5,000 –∂–µ—Ç–æ–Ω–æ–≤ –≤ –ø—Ä–∏–∑–æ–≤–æ–º –ø—É–ª–µ",wheel:"–ö–æ–ª–µ—Å–æ –î–Ω—è",wheelSub:"–ö—Ä—É—Ç–∏ –∑–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–æ–Ω–µ—Ç—ã!",wheelSpin:"–ö–†–£–¢–ò!",collect:"–ó–ê–ë–†–ê–¢–¨",bonusRound:"üé∞ –ë–û–ù–£–° –†–ê–£–ù–î üé∞",spinL:"–°–ü–ò–ù",winL:"–í–´–ò–ì–†–´–®",buyBonus:"–ö—É–ø–∏—Ç—å –ë–æ–Ω—É—Å",slotName:"Ruby Slots",slotTag:"–ì–û–†–Ø–ß–ï–ï",crashName:"Crash",diceName:"–ö–æ—Å—Ç–∏",mineName:"–ú–∏–Ω—ã",coinName:"–ú–æ–Ω–µ—Ç–∫–∞",rouletteName:"–†—É–ª–µ—Ç–∫–∞",blackjackName:"–ë–ª–µ–∫–¥–∂–µ–∫",comingTag:"–°–ö–û–†–û",freeSpins:"–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Å–ø–∏–Ω—ã",noMoney:"–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!",noMoneyDesc:"–ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å",depositBtn:"–ü–æ–ø–æ–ª–Ω–∏—Ç—å",cancelBtn:"–û—Ç–º–µ–Ω–∞",lose:"–ù–µ—Ç –≤—ã–∏–≥—Ä—ã—à–∞",win:"–í–´–ò–ì–†–´–®",totalBalance:"–û–ë–©–ò–ô –ë–ê–õ–ê–ù–°",withdraw:"–í–´–í–ï–°–¢–ò",transHistory:"–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π",selectPkg:"–í–´–ë–ï–†–ò–¢–ï –ü–ê–ö–ï–¢",bonusTitle:"–ë–æ–Ω—É—Å—ã",exclusive:"–≠–ö–°–ö–õ–Æ–ó–ò–í–ù–û",bfTitle:"100% –ë–æ–Ω—É—Å –Ω–∞ –î–µ–ø–æ–∑–∏—Ç",bfDesc:"–£–¥–≤–æ–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –¥–µ–ø–æ–∑–∏—Ç. –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ.",bfTimer:"–ò—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 24—á",wager:"–°–¢–ê–í–ö–ê",activate:"–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å",freeSpinsTitle:"50 –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –°–ø–∏–Ω–æ–≤",freeSpinsDesc:"–î–ª—è Ruby Slots. –ë–µ–∑ –¥–µ–ø–æ–∑–∏—Ç–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤.",claimNow:"–ü–æ–ª—É—á–∏—Ç—å",cashbackTitle:"–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –ö—ç—à–±–µ–∫",cashbackDesc:"–ü–æ–ª—É—á–∏—Ç–µ 10% –≤–æ–∑–≤—Ä–∞—Ç –∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫. VIP –¥–æ 20%.",joinClub:"–í—Å—Ç—É–ø–∏—Ç—å",vipTitle:"–ë—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤—ã–π VIP",vipDesc:"–†–∞–∑–±–ª–æ–∫–∏—Ä—É–π—Ç–µ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä—ã.",inviteEarn:"–ü—Ä–∏–≥–ª–∞—à–∞–π –∏ –ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π",inviteDesc:"–ü–æ–¥–µ–ª–∏—Å—å —Å—Å—ã–ª–∫–æ–π –∏ –ø–æ–ª—É—á–∏ 10 –∂–µ—Ç–æ–Ω–æ–≤ –∑–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞.",tapCopy:"–ù–ê–ñ–ú–ò–¢–ï –ß–¢–û–ë–´ –°–ö–û–ü–ò–†–û–í–ê–¢–¨",copy:"–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å",totalRefs:"–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ",earnedCoins:"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –∂–µ—Ç–æ–Ω–æ–≤",howItWorks:"–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç",step1T:"–ü–æ–¥–µ–ª–∏—Å—å —Å –¥—Ä—É–∑—å—è–º–∏",step1D:"–û—Ç–ø—Ä–∞–≤—å —Å—Å—ã–ª–∫—É —á–µ—Ä–µ–∑ Telegram –∏–ª–∏ —Å–æ—Ü—Å–µ—Ç–∏.",step2T:"–î—Ä—É–∑—å—è –Ω–∞—á–∏–Ω–∞—é—Ç –∏–≥—Ä–∞—Ç—å",step2D:"–ö–æ–≥–¥–∞ –æ–Ω–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è, –æ–±–∞ –ø–æ–ª—É—á–∞—Ç –±–æ–Ω—É—Å.",step3T:"–°–æ–±–∏—Ä–∞–π –ù–∞–≥—Ä–∞–¥—ã",step3D:"–ü–æ–ª—É—á–∏ 10 –∂–µ—Ç–æ–Ω–æ–≤ –∑–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω–æ–≥–æ.",shareNow:"–ü–æ–¥–µ–ª–∏—Ç—å—Å—è",wins:"–ü–û–ë–ï–î–´",losses:"–ü–û–†–ê–ñ–ï–ù–ò–Ø",total:"–í–°–ï–ì–û",referralProgram:"–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ü—Ä–æ–≥—Ä–∞–º–º–∞",inviteFriends:"–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π",settings:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏",security:"–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å",support:"–ü–æ–¥–¥–µ—Ä–∂–∫–∞",signOut:"–í—ã–π—Ç–∏",currentXp:"–¢–µ–∫—É—â–∏–π XP",level:"–£—Ä–æ–≤–µ–Ω—å",slots:"–°–ª–æ—Ç—ã",live:"–õ–∞–π–≤",crash:"Crash",table:"–°—Ç–æ–ª—ã",jackpotLabel:"–í–ï–õ–ò–ö–ò–ô –î–ñ–ï–ö–ü–û–¢",grandJackpot:"GRAND JACKPOT",coins:"–∂–µ—Ç–æ–Ω–æ–≤"},
en:{home:"Home",games:"Games",bonuses:"Bonuses",wallet:"Wallet",profile:"Profile",spin:"SPIN",deposit:"DEPOSIT",searchPlaceholder:"Search games...",categories:"CATEGORIES",viewAll:"VIEW ALL",trending:"TRENDING NOW",playNow:"PLAY NOW",hot:"HOT",heroTitle:"RUBY JACKPOT",heroSub:"5,000 coins prize pool",wheel:"Daily Wheel",wheelSub:"Spin for free coins!",wheelSpin:"SPIN!",collect:"COLLECT",bonusRound:"üé∞ BONUS ROUND üé∞",spinL:"SPIN",winL:"WIN",buyBonus:"Buy Bonus",slotName:"Ruby Slots",slotTag:"HOT",crashName:"Crash",diceName:"Dice",mineName:"Mines",coinName:"Coin Flip",rouletteName:"Roulette",blackjackName:"Blackjack",comingTag:"SOON",freeSpins:"Free spins",noMoney:"Not enough coins!",noMoneyDesc:"Top up your balance to keep playing",depositBtn:"Deposit",cancelBtn:"Cancel",lose:"No win",win:"WIN",totalBalance:"TOTAL BALANCE",withdraw:"WITHDRAW",transHistory:"View Transaction History",selectPkg:"SELECT PACKAGE",bonusTitle:"Bonuses",exclusive:"EXCLUSIVE",bfTitle:"100% Deposit Match",bfDesc:"Get up to 1 BTC on your first deposit. Double your playing money instantly.",bfTimer:"Expires in 24h",wager:"WAGER",activate:"Activate",freeSpinsTitle:"50 Free Spins",freeSpinsDesc:"Valid for Ruby Slots. No deposit required for new players.",claimNow:"Claim Now",cashbackTitle:"Weekly Cashback",cashbackDesc:"Get 10% back on all losses every Monday. VIP tiers get up to 20%.",joinClub:"Join Club",vipTitle:"Diamond VIP Status",vipDesc:"Unlock exclusive tournaments.",inviteEarn:"Invite & Earn",inviteDesc:"Share your link and earn <b>10 coins</b> for every friend who plays.",tapCopy:"TAP COPY TO SHARE",copy:"Copy",totalRefs:"Total Referrals",earnedCoins:"Earned Coins",howItWorks:"How it Works",step1T:"Share with friends",step1D:"Send your unique link via Telegram or social media.",step2T:"Friends start playing",step2D:"When they register, you both get bonus coins.",step3T:"Earn Rewards",step3D:"Get 10 coins for every friend who joins.",shareNow:"Share Link Now",wins:"WINS",losses:"LOSSES",total:"TOTAL",referralProgram:"Referral Program",inviteFriends:"Invite friends & earn rewards",settings:"Settings",security:"Security",support:"Support",signOut:"Sign Out",currentXp:"Current XP",level:"Level",slots:"Slots",live:"Live",crash:"Crash",table:"Table",jackpotLabel:"GRAND JACKPOT",grandJackpot:"GRAND JACKPOT",coins:"coins"}
};
const T=LC[LANG]||LC.en;
const BSYM=['üçí','üçã','üçä','üçá','üç´','üç≠','üç¨','üíé'];
const BONSYM=['üëë','üíé','‚≠ê','‚ù§Ô∏è','üçÄ','üß≤','üí∞','üåà'];
let balance=null,freeSpins=0,bet=5,spinning=false,currentScreen='lobby';
let currentLang=LANG;
let activeWallet='usdt'; /* 'usdt' or 'stars' */

/* === SPEED SYSTEM === */
let speedMode=1;
const SPEED={
    0:{ai:120,af:12,rd:800,bf:10,bp:600,bmp:500},
    1:{ai:70,af:8,rd:400,bf:6,bp:300,bmp:350},
    2:{ai:30,af:4,rd:100,bf:3,bp:80,bmp:100}
};
function S(){return SPEED[speedMode]}
function setSpeed(s){speedMode=s;document.querySelectorAll('.speed-btn').forEach(function(b,i){b.classList.toggle('on',i===s)})}

function auth(){var p={};if(tg.initData)p.init_data=tg.initData;if(UID)p.uid=UID;if(TOK)p.token=TOK;return p}
function qs(){return new URLSearchParams(auth()).toString()}
function sleep(ms){return new Promise(function(r){setTimeout(r,ms)})}

/* === TOAST === */
var toastCb=null;
function showToast(icon,text,ok,cancel,onOk){
    document.getElementById('toastIcon').textContent=icon;document.getElementById('toastText').textContent=text;
    document.getElementById('toastOk').textContent=ok;document.getElementById('toastCancel').textContent=cancel||'‚úï';
    toastCb=onOk;document.getElementById('toast').classList.add('show');
}
function closeToast(){document.getElementById('toast').classList.remove('show');toastCb=null}
function toastAction(){var c=toastCb;closeToast();if(c)c()}

/* === NAVIGATION === */
function nav(s){
    if(s==='deposit'){s='wallet'} /* deposit ‚Üí wallet page */
    document.querySelectorAll('.screen').forEach(function(e){e.classList.remove('active')});
    document.querySelectorAll('.nav-item').forEach(function(e){e.classList.remove('active')});
    var map={lobby:'scrLobby',game:'scrGame',bonuses:'scrBonuses',wallet:'scrWallet',referral:'scrReferral',profile:'scrProfile'};
    var scr=document.getElementById(map[s]);if(scr)scr.classList.add('active');
    var ni=document.querySelector('.nav-item[data-screen="'+s+'"]');if(ni)ni.classList.add('active');
    currentScreen=s;
    if(s==='game')initGame();
    if(s==='profile')loadProfile();
    if(s==='referral')loadReferral();
    if(s==='wallet'){updateWallet();switchWalletTab(activeWallet)}
    window.scrollTo(0,0);
}

/* === DATA === */
/* Balance functions are defined later in the file with full dual-balance support */
function getActiveBalance(){
    if(activeWallet==='stars') return balanceStars;
    return usdtBalance;
}
function getActiveUnit(){
    if(activeWallet==='stars') return '‚≠ê';
    return displayCurrency;
}
function updateVIP(v){
    document.getElementById('vipIcon').textContent=v.icon;
    document.getElementById('vipName').textContent=v.name;
    var pct=0;
    if(v.next_at){pct=Math.min(100,Math.round(v.wagered/v.next_at*100))}else{pct=100}
    document.getElementById('vipBar').style.width=pct+'%';
    document.getElementById('vipPct').textContent=pct+'%';
}

/* === GAME === */
function initGame(){
    var g=document.getElementById('grid');
    if(!g.children.length){for(var i=0;i<30;i++){var c=document.createElement('div');c.className='cell';c.textContent=BSYM[Math.floor(Math.random()*BSYM.length)];g.appendChild(c)}}
    updateSpinBtn();updateBetDisplay();
}
function updateSpinBtn(){
    var btn=document.getElementById('spinBtn'),txt=document.getElementById('spinTxt'),ico=document.getElementById('spinIcon');
    btn.className='spin-btn';btn.disabled=false;
    if(balance===null){btn.classList.add('m-load');txt.textContent='...';ico.textContent='hourglass_empty'}
    else if(balance<bet&&freeSpins<=0){btn.classList.add('m-deposit');txt.textContent=T.deposit;ico.textContent='add_card'}
    else{btn.classList.add('m-spin');txt.textContent=freeSpins>0?'‚ö° '+T.spin:T.spin;ico.textContent='play_arrow'}
}
var BET_STEPS=[5,10,25,50];
var betIndex=0;
function updateBetDisplay(){
    document.getElementById('betDisplay').textContent=bet+'.0';
    document.getElementById('bbPrice').textContent=bet*100;
}
function changeBet(dir){
    if(spinning)return;
    betIndex=BET_STEPS.indexOf(bet);
    if(betIndex===-1)betIndex=0;
    betIndex+=dir;
    if(betIndex<0)betIndex=0;
    if(betIndex>=BET_STEPS.length)betIndex=BET_STEPS.length-1;
    bet=BET_STEPS[betIndex];
    updateBetDisplay();updateSpinBtn();
}
function setMaxBet(){
    if(spinning)return;
    bet=BET_STEPS[BET_STEPS.length-1];
    betIndex=BET_STEPS.length-1;
    updateBetDisplay();updateSpinBtn();
}
function toggleAutoSpeed(){
    speedMode=(speedMode+1)%3;
    var labels=['üê¢','‚ñ∂Ô∏è','‚ö°'];
    document.getElementById('autoLabel').textContent=labels[speedMode];
}
function doSpin(){
    if(balance===null)return;
    if(balance<bet&&freeSpins<=0){nav('wallet');return}
    spin();
}

/* === SPIN === */
async function spin(){
    if(spinning)return;spinning=true;var btn=document.getElementById('spinBtn');btn.disabled=true;
    document.getElementById('gameResult').innerHTML='';
    document.querySelectorAll('#grid .cell').forEach(function(c){c.className='cell'});
    var cells=document.querySelectorAll('#grid .cell');var sp=S();var frame=0;
    var anim=setInterval(function(){cells.forEach(function(c){c.textContent=BSYM[Math.floor(Math.random()*BSYM.length)]});frame++;if(frame>=sp.af)clearInterval(anim)},sp.ai);
    try{
        var useFree=freeSpins>0&&balance<bet;
        var r=await fetch(API+'/api/spin',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(Object.assign({},auth(),{bet:bet,use_free_spin:useFree}))});
        var d=await r.json();await sleep(sp.ai*sp.af);clearInterval(anim);
        if(!d.ok){spinning=false;btn.disabled=false;if(d.balance!==undefined)balance=d.balance;updateBalanceUI();return}
        balance=d.balance;freeSpins=d.free_spins||freeSpins;
        d.grid.forEach(function(s,i){cells[i].textContent=s;if(s==='üé∞')cells[i].classList.add('scatter')});
        if(d.winnings>0){var co={};d.grid.forEach(function(s){if(s!=='üé∞')co[s]=(co[s]||0)+1});
            var ws=new Set(Object.entries(co).filter(function(e){return e[1]>=8}).map(function(e){return e[0]}));
            cells.forEach(function(c){if(ws.has(c.textContent))c.classList.add('win')})}
        await sleep(sp.rd);var res=document.getElementById('gameResult');
        if(d.triggered_bonus){res.innerHTML='<span style="color:var(--red)">üé∞ BONUS! '+d.scatter_count+'x</span>';
            updateBalanceUI();setTimeout(function(){startBonus('triggered')},speedMode===2?400:1200)}
        else{res.innerHTML=d.winnings>0?'<span class="win-text">'+T.win+': +'+d.winnings+' ü™ô</span>':'<span class="lose-text">'+T.lose+'</span>';updateBalanceUI()}
    }catch(e){clearInterval(anim)}
    spinning=false;btn.disabled=false;
}

/* === BONUS === */
async function startBonus(mode){
    spinning=true;document.getElementById('bonusOL').classList.add('show');
    document.getElementById('boTitle').textContent=T.bonusRound;
    document.getElementById('boSpinL').textContent=T.spinL;document.getElementById('boTotalL').textContent=T.winL;
    document.getElementById('boClose').style.display='none';document.getElementById('boFinal').textContent='';document.getElementById('boRes').textContent='';
    document.getElementById('boSpinC').textContent='0/10';document.getElementById('boRunT').textContent='0';
    var bg=document.getElementById('boGrid');bg.innerHTML='';
    for(var i=0;i<30;i++){var c=document.createElement('div');c.className='cell';c.textContent=BONSYM[Math.floor(Math.random()*BONSYM.length)];bg.appendChild(c)}
    try{
        var r=await fetch(API+'/api/bonus',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(Object.assign({},auth(),{bet:bet,mode:mode}))});
        var d=await r.json();if(!d.ok){if(d.error==='funds')showToast('üí∞',T.noMoney+'\n'+T.noMoneyDesc,T.depositBtn,T.cancelBtn,function(){nav('wallet')});closeBonus();return}
        var bc=bg.querySelectorAll('.cell');var sp=S();
        for(var j=0;j<d.spins.length;j++){var sn=d.spins[j];
            document.getElementById('boSpinC').textContent=sn.spin_number+'/'+sn.total_spins;
            for(var t=0;t<sp.bf;t++){bc.forEach(function(c){c.textContent=BONSYM[Math.floor(Math.random()*BONSYM.length)]});await sleep(sp.ai)}
            sn.grid.forEach(function(s,i){bc[i].textContent=s;bc[i].className='cell';if(s==='üé∞')bc[i].classList.add('scatter');else if(s==='üí£')bc[i].classList.add('bomb')});
            if(sn.winning_symbols){var ws=new Set(Object.keys(sn.winning_symbols));bc.forEach(function(c){if(ws.has(c.textContent))c.classList.add('win')})}
            await sleep(sp.bp/2);
            if(sn.bombs&&sn.bombs.length>0&&sn.base_win>0){for(var k=0;k<sn.bombs.length;k++){showBombPop(sn.bombs[k].mult);await sleep(sp.bmp)}}
            document.getElementById('boRes').innerHTML=sn.winnings>0?'<span style="color:var(--green)">+'+sn.winnings+(sn.total_bomb_mult>1?' üí£x'+sn.total_bomb_mult:'')+'</span>':'‚Äî';
            if(sn.retrigger){document.getElementById('boRes').innerHTML+='<br><span style="color:var(--red)">+5!</span>';await sleep(sp.bp)}
            document.getElementById('boRunT').textContent=sn.running_total;await sleep(sp.bp);
        }
        balance=d.balance;document.getElementById('boRes').textContent='';
        document.getElementById('boFinal').innerHTML='üèÜ '+d.total_win+' ü™ô';
        var cb=document.getElementById('boClose');cb.textContent=T.collect+' '+d.total_win+' ü™ô';cb.style.display='block';
    }catch(e){closeBonus()}
}
function closeBonus(){document.getElementById('bonusOL').classList.remove('show');spinning=false;updateBalanceUI()}
function showBombPop(m){var e=document.createElement('div');e.className='bomb-pop';e.textContent='üí£ x'+m;document.body.appendChild(e);setTimeout(function(){e.remove()},800)}
function buyBonus(){if(!balance||balance<bet*100){showToast('üí∞',T.noMoney+'\n'+T.noMoneyDesc,T.depositBtn,T.cancelBtn,function(){nav('wallet')});return}startBonus('bought')}

/* === WHEEL === */
var WSEG=[{l:'5 ü™ô',c:'#1a0a0a'},{l:'10 ü™ô',c:'#2a1a1a'},{l:'25 ü™ô',c:'#1a0a0a'},{l:'50 ü™ô',c:'#2a1a1a'},{l:'100 ü™ô',c:'#1a0a0a'},{l:'3 ‚ö°',c:'#2a1a1a'},{l:'5 ‚ö°',c:'#1a0a0a'},{l:'250 ü™ô',c:'#2a1a1a'},{l:'500 ü™ô',c:'#1a0a0a'}];
var wAngle=0;
function drawWheel(){
    var cv=document.getElementById('wheelCanvas');if(!cv)return;
    var ctx=cv.getContext('2d'),cx=130,cy=130,r=125,n=WSEG.length,arc=2*Math.PI/n;
    ctx.clearRect(0,0,260,260);
    for(var i=0;i<n;i++){var a=i*arc-Math.PI/2;
        ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,r,a,a+arc);ctx.closePath();
        ctx.fillStyle=WSEG[i].c;ctx.fill();ctx.strokeStyle='rgba(227,30,36,0.2)';ctx.lineWidth=1.5;ctx.stroke();
        ctx.save();ctx.translate(cx,cy);ctx.rotate(a+arc/2);
        ctx.fillStyle='#fff';ctx.font='bold 12px Montserrat,sans-serif';ctx.textAlign='center';ctx.fillText(WSEG[i].l,r*0.62,4);
        ctx.restore();
    }
    ctx.beginPath();ctx.arc(cx,cy,r,0,2*Math.PI);ctx.strokeStyle='rgba(227,30,36,0.3)';ctx.lineWidth=3;ctx.stroke();
}
function openWheel(){
    document.getElementById('wheelOL').classList.add('show');
    document.getElementById('woTitle').textContent='üé° '+T.wheel;
    document.getElementById('woBtn').textContent=T.wheelSpin;document.getElementById('woBtn').disabled=false;
    document.getElementById('woPrize').textContent='';
    var cv=document.getElementById('wheelCanvas');cv.style.transition='none';cv.style.transform='rotate('+wAngle+'deg)';
    drawWheel();
}
async function spinWheel(){
    document.getElementById('woBtn').disabled=true;
    var extra=1800+Math.random()*720;wAngle+=extra;
    var cv=document.getElementById('wheelCanvas');
    cv.style.transition='transform 4s cubic-bezier(.17,.67,.05,.99)';cv.style.transform='rotate('+wAngle+'deg)';
    try{
        var r=await fetch(API+'/api/wheel',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(auth())});
        var d=await r.json();await sleep(4200);
        if(d.ok){balance=d.balance;freeSpins=d.free_spins||0;
            var p=d.prize;document.getElementById('woPrize').textContent=p.type==='coins'?'+'+p.value+' ü™ô':'+'+p.value+' ‚ö° '+T.freeSpins;
            document.getElementById('wheelBanner').classList.add('done');updateBalanceUI();
            await sleep(2500);document.getElementById('wheelOL').classList.remove('show');
            setTimeout(function(){cv.style.transition='none'},100);
        }else{document.getElementById('woPrize').textContent='‚è≥';await sleep(1500);document.getElementById('wheelOL').classList.remove('show');setTimeout(function(){cv.style.transition='none'},100)}
    }catch(e){await sleep(4200);document.getElementById('wheelOL').classList.remove('show');setTimeout(function(){cv.style.transition='none'},100)}
}

/* === PROFILE === */
async function loadProfile(){
    try{var r=await fetch(API+'/api/profile?'+qs());var d=await r.json();if(!d.ok)return;
        document.getElementById('profName').textContent=d.first_name||d.username||'Player';
        document.getElementById('profId').textContent='ID: '+(UID?UID.toString().slice(-8):'...');
        document.getElementById('profVipBadge').textContent=d.vip.name;
        document.getElementById('profLevelName').textContent=d.vip.icon+' '+d.vip.name;
        var pct=0;
        if(d.vip.next_at){pct=Math.min(100,Math.round(d.vip.wagered/d.vip.next_at*100))}else{pct=100}
        document.getElementById('profVipBar').style.width=pct+'%';
        document.getElementById('profLevelVal').textContent=T.level+' '+(['Bronze','Silver','Gold','Platinum','Diamond'].indexOf(d.vip.name)+1);
        document.getElementById('profXpVal').textContent=d.stats.wagered+' / '+(d.vip.next_at||'MAX');
        /* Stats: wins = bets with positive profit, losses = bets with zero/negative */
        var wins=0,losses=0;
        if(d.recent_bets){d.recent_bets.forEach(function(b){if(b.profit>0)wins++;else losses++})}
        document.getElementById('stWins').textContent=d.stats.won>0?wins:0;
        document.getElementById('stLosses').textContent=losses;
        document.getElementById('stTotal').textContent=d.stats.spins;
    }catch(e){}}

/* === REFERRAL === */
function loadReferral(){
    var refUrl='https://t.me/'+BOT+'?start=ref'+UID;
    document.getElementById('refUrl').textContent=refUrl;
}
function copyRefLink(){
    var url='https://t.me/'+BOT+'?start=ref'+UID;
    if(navigator.clipboard){navigator.clipboard.writeText(url).then(function(){
        var btn=document.querySelector('.ref-copy');btn.innerHTML='<span class="material-symbols-outlined" style="font-size:16px">check</span> OK';
        setTimeout(function(){btn.innerHTML='<span class="material-symbols-outlined" style="font-size:16px">content_copy</span>'+T.copy},2000);
    })}
}
function shareRef(){tg.openTelegramLink('https://t.me/share/url?url=https://t.me/'+BOT+'?start=ref'+UID+'&text=üé∞')}
function changeLang(){openLangSelector()}
async function checkWheel(){try{var r=await fetch(API+'/api/wheel-status?'+qs());var d=await r.json();if(d.ok&&!d.available)document.getElementById('wheelBanner').classList.add('done')}catch(e){}}

/* === INIT LOCALE === */
function initLocale(){
    /* Nav */
    document.getElementById('navLobby').textContent=T.home;
    document.getElementById('navGame').textContent=T.games;
    document.getElementById('navBonuses').textContent=T.bonuses;
    document.getElementById('navWallet').textContent=T.wallet;
    document.getElementById('navProfile').textContent=T.profile;
    /* Header */
    document.getElementById('headerUnit').textContent=T.coins;
    /* Lobby */
    document.getElementById('searchPlaceholder').textContent=T.searchPlaceholder;
    document.getElementById('heroTag').textContent=T.hot;
    document.getElementById('heroTitle').innerHTML='RUBY <span class="accent">JACKPOT</span>';
    document.getElementById('heroSub').textContent=T.heroSub;
    document.getElementById('heroPlay').textContent=T.playNow;
    document.getElementById('wheelTitle').textContent=T.wheel;
    document.getElementById('wheelSub').textContent=T.wheelSub;
    document.getElementById('secCat').textContent=T.categories;
    document.getElementById('secCatMore').textContent=T.viewAll;
    document.getElementById('secTrending').textContent=T.trending;
    /* Game */
    document.getElementById('bbLabel').textContent=T.buyBonus;
    document.getElementById('jackpotLabel').textContent=T.grandJackpot;
    document.getElementById('betUnit').textContent=T.coins;
    document.getElementById('betAmountLabel').textContent=LANG==='pl'?'KWOTA ZAK≈ÅADU':LANG==='ru'?'–°–£–ú–ú–ê –°–¢–ê–í–ö–ò':LANG==='ua'?'–°–£–ú–ê –°–¢–ê–í–ö–ò':'BET AMOUNT';
    /* Bonuses */
    document.getElementById('bonusTitle').textContent=T.bonusTitle;
    document.getElementById('bfTag').textContent=T.exclusive;
    document.getElementById('bfTimer').textContent=T.bfTimer;
    document.getElementById('bfTitle').textContent=T.bfTitle;
    document.getElementById('bfDesc').textContent=T.bfDesc;
    document.getElementById('bfWagerL').textContent=T.wager;
    document.getElementById('bfActivate').textContent=T.activate;
    document.getElementById('bc1Title').textContent=T.freeSpinsTitle;
    document.getElementById('bc1Desc').textContent=T.freeSpinsDesc;
    document.getElementById('bc1Btn').textContent=T.claimNow;
    document.getElementById('bc2Title').textContent=T.cashbackTitle;
    document.getElementById('bc2Desc').textContent=T.cashbackDesc;
    document.getElementById('bc2Btn').textContent=T.joinClub;
    document.getElementById('blTitle').textContent=T.vipTitle;
    document.getElementById('blDesc').textContent=T.vipDesc;
    /* Wallet */
    document.getElementById('wBalLabel').textContent=T.totalBalance;
    document.getElementById('wDeposit').textContent=T.deposit;
    document.getElementById('wWithdraw').textContent=T.withdraw;
    document.getElementById('wHistory').textContent=T.transHistory;
    var wml=document.getElementById('wMethodLabel');if(wml)wml.textContent=LANG==='ru'?'–ú–ï–¢–û–î –û–ü–õ–ê–¢–´':LANG==='ua'?'–ú–ï–¢–û–î –û–ü–õ–ê–¢–ò':LANG==='pl'?'METODA P≈ÅATNO≈öCI':'PAYMENT METHOD';
    var wpl=document.getElementById('wPkgLabel');if(wpl)wpl.textContent=T.selectPkg;
    var pct=document.getElementById('pmCardTitle');if(pct)pct.textContent=LANG==='ru'?'–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞':LANG==='ua'?'–ë–∞–Ω–∫—ñ–≤—Å—å–∫–∞ –∫–∞—Ä—Ç–∫–∞':LANG==='pl'?'Karta bankowa':'Bank Card';
    /* Referral */
    document.getElementById('refHeroTitle').innerHTML=T.inviteEarn.replace('&','&amp;').replace(/(Earn|Zarabiaj|–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π|–ó–∞—Ä–æ–±–ª—è–π)/,'<span>$1</span>');
    document.getElementById('refHeroDesc').innerHTML=T.inviteDesc;
    document.getElementById('refLinkLabel').textContent=T.tapCopy;
    document.getElementById('refCopyText').textContent=T.copy;
    document.getElementById('refTotalLabel').textContent=T.totalRefs;
    document.getElementById('refEarnedLabel').textContent=T.earnedCoins;
    document.getElementById('refHowTitle').textContent=T.howItWorks;
    document.getElementById('refStep1T').textContent=T.step1T;document.getElementById('refStep1D').textContent=T.step1D;
    document.getElementById('refStep2T').textContent=T.step2T;document.getElementById('refStep2D').textContent=T.step2D;
    document.getElementById('refStep3T').textContent=T.step3T;document.getElementById('refStep3D').textContent=T.step3D;
    document.getElementById('refShareBtn').textContent=T.shareNow;
    /* Profile */
    document.getElementById('stWinsL').textContent=T.wins;
    document.getElementById('stLossesL').textContent=T.losses;
    document.getElementById('stTotalL').textContent=T.total;
    document.getElementById('profRefTitle').textContent=T.referralProgram;
    document.getElementById('profRefSub').textContent=T.inviteFriends;
    document.getElementById('profSettings').textContent=T.settings;
    document.getElementById('profSecurity').textContent=T.security;
    document.getElementById('profSupport').textContent=T.support;
    document.getElementById('profSignout').textContent=T.signOut;
    document.getElementById('profXpLabel').textContent=T.currentXp;
}

/* === BUILD DYNAMIC CONTENT === */
function buildBonusPills(){
    var pillLabels=['All','Deposit','Free Spins','VIP','Cashback'];
    if(LANG==='ru')pillLabels=['–í—Å–µ','–î–µ–ø–æ–∑–∏—Ç','–§—Ä–∏—Å–ø–∏–Ω—ã','VIP','–ö—ç—à–±–µ–∫'];
    if(LANG==='ua')pillLabels=['–í—Å–µ','–î–µ–ø–æ–∑–∏—Ç','–§—Ä—ñ—Å–ø—ñ–Ω–∏','VIP','–ö–µ—à–±–µ–∫'];
    if(LANG==='pl')pillLabels=['Wszystkie','Depozyt','Darmowe Spiny','VIP','Cashback'];
    var bp = document.getElementById('bonusPills');
    if (bp) {
        bp.innerHTML=pillLabels.map(function(p,i){
            return '<div class="pill'+(i===0?' active':'')+'" onclick="this.parentNode.querySelectorAll('.pill').forEach(function(e){e.classList.remove('active')});this.classList.add('active')">'+p+'</div>';
        }).join('');
    }
}
function buildCategories(){
    var cats=[
        {icon:'casino',label:T.slots,screen:'game'},
        {icon:'stream',label:T.live,screen:null},
        {icon:'trending_up',label:T.crash,screen:null},
        {icon:'playing_cards',label:T.table,screen:null}
    ];
    document.getElementById('catRow').innerHTML=cats.map(function(c){
        return '<div class="cat-item" onclick="'+(c.screen?'nav(\''+c.screen+'\')':'')+'">'
            +'<div class="cat-icon"><span class="material-symbols-outlined">'+c.icon+'</span></div>'
            +'<div class="cat-label">'+c.label+'</div></div>';
    }).join('');
}

function buildGameGrid(){
    var IMG={
        slots:'https://lh3.googleusercontent.com/aida-public/AB6AXuCGPEWfXzJNFUB_EXtz51yNIgZjSz3ob9Sd6-OvSGCEov_UGnbjxRwxMthy3MaZd1y3sSKFQxwzinGVFSSUX6MX9LyQcbKOBjS5_h1pMDeP_qC8HgHFFIgVYK41U0IvGrywNBdnYg_6F9KYsRPzmehtL1exPYlIBqyl0I_OSqEwsbDA2rCwRGfu5u_cfHLtbQ7-BRMS0J7mw0JvhGp8lvR9IZ4OtqySVweNv6ohZpAhMhQlsEN84latpHmJh9r7dfdWo9zYOsB4JI0',
        cubes:'https://lh3.googleusercontent.com/aida-public/AB6AXuDaEolN36F7I9DO5xzDpZJT44gKy0UqcrJkYSpxyvjhw60tyAD7Gy1Bh8-CCjn0wUqGk1dsU3gdG_wlCSodYaiglPb9p8QgUqGUehCxqDwVJx93ersDjvbFa3lgxVwIN2gd29K0ZxblLEP1EkgNZjgTh-fyy3QTKfOvEz8y3gytYBMe2jAJiNryHDsJPpexYxJRkJes_Fb1dmeQ8JqtUOssDqpIUiDNt9FwWXyXoN3at4S1zDC3DhMbXR_TZYjG8VkEpKZFQ2t4ucw',
        chips:'https://lh3.googleusercontent.com/aida-public/AB6AXuAV67NDOkqHDYuJOwD9Je6tBpmvW3RSI4HF0XkpQdgV_iaaVZYQdnLiQU89PymnRn5IxYBRn0BekcKrZ7NHIYjIugI9wO6OBWtjh95WkV_gWTsuQYmVQBUUNzx_4PBG6K0GmTJ0X4UIHtuR-300bhj-NrT24I4jFK3PVoXbEiArjjbMMNC2Z1gegewHMhPAo6Jv8jx7YoLzIBfS7qP7BZW6Egl5S2nvhVfyUlcT7IWmtAyp3Nmk9-kJ1ey0wszCI9yv8Z5gVji0xsQ',
        diamond:'https://lh3.googleusercontent.com/aida-public/AB6AXuB75EFJ8WIHV-d3TCC0alchWDHTnjGNxWnlJ-CXg6bUaiLzn5to-juivqE1pzeF5TptEeGKwMiKm5NxX5ceNXqUF8x0mTtKAGfHxwEB7-N6TDbNSBxzgVPMLvcPL-WfAIfpJ7o2OL92a__p0S8W_kps90q9TiQ29-7BWlUNCnuZz77-TLZDCiNaUpGKDAs2Tg67FuFyipOljK3xuYXjy0Ak2HIjQODAxVnZH8zc-AO4k8AV6WfqGNcUV0aOMUDJQ77HTwTifyNSP3Y'
    };
    var games=[
        {emoji:'üç≠',name:T.slotName,tag:T.slotTag,badge:'hot',bg:"url('"+IMG.slots+"') center/cover",screen:'game'},
        {emoji:'üìà',name:T.crashName,tag:T.comingTag,badge:'soon',bg:"url('"+IMG.cubes+"') center/cover",screen:null},
        {emoji:'üé≤',name:T.diceName,tag:T.comingTag,badge:'soon',bg:"url('"+IMG.chips+"') center/cover",screen:null},
        {emoji:'üí£',name:T.mineName,tag:T.comingTag,badge:'soon',bg:"url('"+IMG.diamond+"') center/cover",screen:null},
        {emoji:'ü™ô',name:T.coinName,tag:T.comingTag,badge:'soon',bg:'linear-gradient(135deg,#1a0a1a,#0a001a)',screen:null},
        {emoji:'üéØ',name:T.rouletteName,tag:T.comingTag,badge:'soon',bg:'linear-gradient(135deg,#2a1a0a,#1a0a00)',screen:null}
    ];
    document.getElementById('gameGrid').innerHTML=games.map(function(g){
        var hasImg=g.bg.indexOf('url')===0;
        return '<div class="game-tile" onclick="'+(g.screen?'nav(\''+g.screen+'\')':'')+'">'
            +'<div class="game-tile-img" style="background:'+g.bg+'">'
            +(hasImg?'<div style="position:absolute;inset:0;background:linear-gradient(to top,var(--surface),transparent 60%)"></div>':'')
            +'<div style="position:relative;z-index:1;font-size:'+(hasImg?'32':'42')+'px;'+(hasImg?'opacity:.8;text-shadow:0 2px 8px rgba(0,0,0,.6)':'')+'">'+g.emoji+'</div>'
            +'<div class="badge '+g.badge+'" style="position:relative;z-index:1">'+g.tag+'</div></div>'
            +'<div class="game-tile-info"><div class="game-tile-name">'+g.name+'</div>'
            +'<div class="game-tile-tag">'+(g.screen?T.slotTag:T.comingTag)+'</div></div></div>';
    }).join('');
}

/* === PERSONAL BONUS SYSTEM === */
function switchBonusTab(tab){
    document.getElementById('segActive').classList.toggle('active',tab==='active');
    document.getElementById('segHistory').classList.toggle('active',tab==='history');
    document.getElementById('bonusActivePanel').style.display=tab==='active'?'block':'none';
    document.getElementById('bonusHistoryPanel').style.display=tab==='history'?'block':'none';
}

/* Fallback demo data ‚Äî used when API is unavailable */
var userBonuses={
    balance:150.00,
    active:[
        {id:1,bonus_type:'cashback',title:'Weekly Cashback',description:'Earn 10% back on all weekly losses',icon:'payments',progress:85.5,max_progress:100,amount:85.50,vip_tag:'',expires_at:'',status:'active',badge:'CASHBACK'},
        {id:2,bonus_type:'free_spins',title:'Loyalty Free Spins',description:"50 Spins on 'Ruby Reels' Deluxe",icon:'casino',progress:0,max_progress:0,amount:50,vip_tag:'VIP GOLD',expires_at:'2026-02-24 15:00:00',status:'active',badge:'FREE SPINS'},
        {id:3,bonus_type:'deposit_match',title:'Deposit Match',description:'Wager $200 more to unlock $50 cash',icon:'trophy',progress:120,max_progress:200,amount:50,vip_tag:'',expires_at:'',status:'active',badge:'DEPOSIT MATCH'}
    ],
    history:[
        {id:10,title:'Welcome Free Bet',claimed_at:'2023-09-28',amount:50.00,status:'completed',badge:'DEPOSIT MATCH',icon:'redeem'},
        {id:11,title:'Weekly Reload Boost',claimed_at:'2023-10-05',amount:25.00,status:'expired',badge:'RELOAD',icon:'timer_off'},
        {id:12,title:'UCL Finals Cashback',claimed_at:'2023-09-15',amount:120.50,status:'completed',badge:'CASHBACK',icon:'sports_soccer'},
        {id:13,title:'Referral Reward',claimed_at:'2023-08-22',amount:10.00,status:'expired',badge:'REFERRAL',icon:'confirmation_number'}
    ]
};

async function loadBonuses(){
    try{
        var r=await fetch(API+'/api/bonuses?'+qs());var d=await r.json();
        if(d.ok){
            userBonuses.balance=d.balance||0;
            if(d.active&&d.active.length>0)userBonuses.active=d.active;
            if(d.history&&d.history.length>0)userBonuses.history=d.history;
        }
    }catch(e){}
    renderActiveBonuses();renderBonusHistory();
}

function renderActiveBonuses(){
    var b=userBonuses;
    document.getElementById('bonusBalAmount').textContent='$'+b.balance.toFixed(2);
    document.getElementById('activeBonusCount').textContent=b.active.length+' Active';
    var html='';
    b.active.forEach(function(a){
        /* Card with left red border accent */
        html+='<div class="glass-card" style="border-left:3px solid var(--red)">';
        html+='<div class="gc-bg-icon"><span class="material-symbols-outlined">'+(a.icon||'redeem')+'</span></div>';
        /* Title + VIP tag */
        html+='<div style="display:flex;justify-content:space-between;align-items:flex-start;position:relative;z-index:1;margin-bottom:2px">';
        html+='<div class="gc-title">'+a.title+'</div>';
        if(a.vip_tag)html+='<span class="gc-vip-tag">'+a.vip_tag+'</span>';
        html+='</div>';
        html+='<div class="gc-desc">'+(a.description||'')+'</div>';

        /* Timer (if expires_at is set and in the future) */
        if(a.expires_at){
            var remaining=getTimeRemaining(a.expires_at);
            if(remaining)html+='<div class="gc-timer"><span class="material-symbols-outlined">timer</span><div><div class="gc-timer-label">Expires In</div><div class="gc-timer-val">'+remaining+'</div></div></div>';
        }

        /* Progress bar */
        if(a.max_progress>0){
            var pct=Math.min(100,Math.round(a.progress/a.max_progress*100));
            var label=a.bonus_type==='deposit_match'?'Wagering Requirement':'Progress';
            html+='<div class="gc-progress"><div class="gc-progress-header"><span class="label">'+label+'</span><span class="val">';
            if(a.bonus_type==='deposit_match')html+=pct+'%';
            else html+='$'+a.progress.toFixed(2)+' / $'+a.max_progress.toFixed(2)+' Max';
            html+='</span></div><div class="gc-progress-bar"><div class="gc-progress-fill" style="width:'+pct+'%"></div></div></div>';
        }

        /* Note for deposit match */
        if(a.bonus_type==='deposit_match')html+='<div style="font-size:10px;color:var(--dim2);font-style:italic;margin-bottom:14px;position:relative;z-index:1">Eligible on Sports and Casino slots.</div>';

        /* Button */
        if(a.bonus_type==='cashback'&&a.progress>0){
            html+='<button class="gc-btn-primary" onclick="claimBonus('+a.id+','+a.progress+')">Claim $'+a.progress.toFixed(2)+'</button>';
        }else if(a.bonus_type==='free_spins'){
            html+='<button class="gc-btn-primary" onclick="activateBonus('+a.id+')">Activate Now</button>';
        }else{
            html+='<button class="gc-btn-outline" onclick="viewBonusDetails('+a.id+')">View Details</button>';
        }
        html+='</div>';
    });
    if(b.active.length===0){
        html+='<div style="text-align:center;padding:40px 0;opacity:.4"><span class="material-symbols-outlined" style="font-size:40px;display:block;margin-bottom:6px">redeem</span><span style="font-size:12px">No active bonuses</span></div>';
    }
        if(document.getElementById('profBonusList')) document.getElementById('profBonusList').innerHTML=html;
    if(document.getElementById('bonusBalAmountProf')) document.getElementById('bonusBalAmountProf').textContent='$'+b.balance.toFixed(2);
    if(document.getElementById('activeBonusCountProf')) document.getElementById('activeBonusCountProf').textContent=b.active.length+' Active';
}

function renderBonusHistory(){
    var h=userBonuses.history;
    var html='';
    h.forEach(function(item){
        var isExpired=item.status==='expired';
        var dateStr=item.claimed_at||item.created_at||'';
        var dateLabel=isExpired?'Expired ':'Claimed ';
        if(dateStr.length>=10)dateLabel+=formatBonusDate(dateStr);

        html+='<div class="history-item'+(isExpired?' expired':'')+'" style="border-left:3px solid '+(isExpired?'var(--border)':'var(--red)')+'">';

        /* Top: icon + info + amount */
        html+='<div class="hi-top"><div style="display:flex;align-items:flex-start;gap:10px"><div class="hi-icon '+(isExpired?'inactive':'active')+'"><span class="material-symbols-outlined" style="color:'+(isExpired?'var(--dim2)':'var(--red)')+';font-variation-settings:\'FILL\' '+(isExpired?'0':'1')+'">'+(item.icon||'redeem')+'</span></div>';
        html+='<div class="hi-info"><div class="hi-title">'+item.title+'</div><div class="hi-date">'+dateLabel+'</div></div></div>';
        html+='<div class="hi-amount"><div class="hi-val"'+(isExpired?' style="color:var(--dim2)"':'')+'>$'+(item.amount||0).toFixed(2)+'</div><div class="hi-val-label">Value</div></div></div>';

        /* Bottom: status + badge */
        html+='<div class="hi-bottom"><div class="hi-status '+(isExpired?'':'completed')+'">';
        if(isExpired)html+='<span class="material-symbols-outlined">cancel</span><span>Expired</span>';
        else html+='<span class="material-symbols-outlined" style="font-variation-settings:\'FILL\' 1">check_circle</span><span>Completed</span>';
        html+='</div><span class="hi-badge">'+(item.badge||item.bonus_type||'BONUS')+'</span></div>';
        html+='</div>';
    });
    if(h.length===0){
        html+='<div style="text-align:center;padding:30px 0;opacity:.4"><span style="font-size:12px">No bonus history yet</span></div>';
    }
    document.getElementById('bonusHistoryList').innerHTML=html;
}

function getTimeRemaining(dateStr){
    try{
        var end=new Date(dateStr.replace(' ','T'));var now=new Date();
        var diff=end-now;if(diff<=0)return null;
        var h=Math.floor(diff/3600000);var m=Math.floor((diff%3600000)/60000);var s=Math.floor((diff%60000)/1000);
        return (h<10?'0':'')+h+'h : '+(m<10?'0':'')+m+'m : '+(s<10?'0':'')+s+'s';
    }catch(e){return null}
}

function formatBonusDate(d){
    try{
        var dt=new Date(d.replace(' ','T'));
        var months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        return months[dt.getMonth()]+' '+dt.getDate()+', '+dt.getFullYear();
    }catch(e){return d}
}

async function claimBonus(id,amount){
    try{
        var r=await fetch(API+'/api/claim-bonus',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(Object.assign({},auth(),{bonus_id:id}))});
        var d=await r.json();
        if(d.ok){
            showToast('‚úÖ','Claimed $'+(amount||0).toFixed(2)+'!','OK','',function(){closeToast()});
            loadBalance();loadBonuses();
        }else{
            showToast('‚ùå',d.error||'Failed to claim','OK','',function(){closeToast()});
        }
    }catch(e){showToast('‚ùå','Network error','OK','',function(){closeToast()})}
}

async function activateBonus(id){
    try{
        var r=await fetch(API+'/api/activate-bonus',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(Object.assign({},auth(),{bonus_id:id}))});
        var d=await r.json();
        if(d.ok){
            var msg=d.free_spins_added?'+'+d.free_spins_added+' Free Spins!':'Bonus activated!';
            showToast('‚ö°',msg,'OK','',function(){closeToast()});
            loadBalance();loadBonuses();
        }else{
            showToast('‚ùå',d.error||'Failed','OK','',function(){closeToast()});
        }
    }catch(e){showToast('‚ùå','Network error','OK','',function(){closeToast()})}
}

function viewBonusDetails(id){
    var bonus=userBonuses.active.find(function(b){return b.id===id});
    if(bonus&&bonus.max_progress>0){
        var remaining=(bonus.max_progress-bonus.progress).toFixed(2);
        showToast('‚ÑπÔ∏è','Wager $'+remaining+' more to unlock $'+bonus.amount.toFixed(2),'OK','',function(){closeToast()});
    }else{
        showToast('‚ÑπÔ∏è','View details','OK','',function(){closeToast()});
    }
}

function initBonuses(){loadBonuses(); buildBonusPills();}

function buildWalletPackages(){
    var pkgs=[{amount:'50',price:'0.50'},{amount:'100',price:'0.90'},{amount:'500',price:'4.00'}];
    document.getElementById('assetRow').innerHTML=pkgs.map(function(p,i){
        return '<button class="asset-btn'+(i===0?' active':'')+'" onclick="selectPkg(this,\''+p.amount+'\',\''+p.price+'\')" data-coins="'+p.amount+'" data-price="'+p.price+'">'+p.amount+' coins<br><span style="font-size:10px;color:var(--dim)">$'+p.price+'</span></button>';
    }).join('');
    /* Stars packages */
    var starPkgs=[{stars:50,price:'50'},{stars:150,price:'150'},{stars:500,price:'500'}];
    var sr=document.getElementById('starsRow');
    if(sr) sr.innerHTML=starPkgs.map(function(p,i){
        return '<button class="asset-btn'+(i===0?' active':'')+'" onclick="selectPkg(this,\''+p.stars+'\',\''+p.price+'\')" data-stars="'+p.stars+'" data-price="'+p.price+'">‚≠ê '+p.stars+'<br><span style="font-size:10px;color:var(--dim)">'+p.price+' ‚≠ê</span></button>';
    }).join('');
}
var selectedPkg={coins:'50',price:'0.50'};
function selectPkg(el,amount,price){
    el.parentNode.querySelectorAll('.asset-btn').forEach(function(b){b.classList.remove('active')});
    el.classList.add('active');
    selectedPkg={coins:amount,price:price};
}

/* === CURRENCY SYSTEM === */
var RATES={USDT:1,USD:1,PLN:4.05,UAH:41.2,EUR:0.92,RUB:96.5};
var displayCurrency='USDT';
var usdtBalance=0; /* internal USDT balance (cents precision) */
var starsBalance=0;
var payMethod='crypto'; /* crypto | card | stars */

function setCurrency(cur){
    displayCurrency=cur;
    document.querySelectorAll('#currencyRow .pill').forEach(function(p){p.classList.toggle('active',p.getAttribute('data-cur')===cur)});
    updateWallet();
    updateBalanceUI();
}

function formatCurrency(usdtAmount,cur){
    if(!cur)cur=displayCurrency;
    var val=usdtAmount*RATES[cur];
    var symbols={USDT:'',USD:'$',PLN:'z≈Ç',UAH:'‚Ç¥',EUR:'‚Ç¨',RUB:'‚ÇΩ'};
    if(cur==='USDT')return val.toFixed(2);
    return symbols[cur]+val.toFixed(2);
}

function updateWallet(){
    var el=document.getElementById('wBalAmount');
    if(el){
        if(displayCurrency==='USDT'){
            el.textContent=usdtBalance.toFixed(2);
            document.getElementById('wBalUnit').textContent='USDT';
        }else{
            el.textContent=formatCurrency(usdtBalance);
            document.getElementById('wBalUnit').textContent=displayCurrency;
        }
    }
    var loc=document.getElementById('wBalLocal');
    if(loc){
        if(displayCurrency!=='USDT')loc.textContent='‚âà '+usdtBalance.toFixed(2)+' USDT';
        else loc.textContent='';
    }
    var se=document.getElementById('wStarsAmount');
    if(se)se.textContent=starsBalance;
}

function updateBalanceUI(){
    var hb=document.getElementById('headerBal');
    var hu=document.getElementById('headerUnit');
    if(activeWallet==='stars'){
        /* Stars mode ‚Äî show stars balance */
        if(hb)hb.textContent=starsBalance;
        if(hu)hu.textContent='‚≠ê';
    }else{
        /* USDT mode ‚Äî show in selected display currency */
        if(hb){
            if(usdtBalance!==null&&usdtBalance!==undefined){
                hb.textContent=displayCurrency==='USDT'?usdtBalance.toFixed(2):formatCurrency(usdtBalance);
            }else{
                hb.textContent='...';
            }
        }
        if(hu)hu.textContent=displayCurrency;
    }
    /* Game balance ‚Äî always show active wallet */
    var gb=document.getElementById('gameBal');
    if(gb){
        if(activeWallet==='stars'){
            gb.textContent=starsBalance+' ‚≠ê';
        }else{
            gb.textContent=usdtBalance!==null?usdtBalance.toFixed(2):'0';
        }
    }
    var fb=document.getElementById('freeBadge');if(fb)fb.textContent=freeSpins>0?'‚ö° '+freeSpins+' '+T.freeSpins:'';
    updateSpinBtn();
}

/* Override loadBalance to set usdtBalance */
async function loadBalance(){
    try{var r=await fetch(API+'/api/balance?'+qs());var d=await r.json();
        if(d.ok){
            balance=d.balance;freeSpins=d.free_spins||0;
            /* Convert coins to USDT ‚Äî 100 coins = $1 USDT */
            usdtBalance=d.balance/100;
            starsBalance=d.stars_balance||0;
            updateBalanceUI();updateWallet();
            if(d.vip)updateVIP(d.vip);
            return;
        }}catch(e){}
    setTimeout(loadBalance,2000);
}

/* === WALLET TAB SWITCH === */
function switchWalletTab(tab){
    document.getElementById('walUsdt').style.display=tab==='usdt'?'block':'none';
    document.getElementById('walStars').style.display=tab==='stars'?'block':'none';
    document.getElementById('walTabUsdt').classList.toggle('active',tab==='usdt');
    document.getElementById('walTabStars').classList.toggle('active',tab==='stars');
}

/* === PAYMENT METHOD === */
function selectPayMethod(method){
    payMethod=method;
    document.getElementById('pmCrypto').style.borderColor=method==='crypto'?'var(--red)':'var(--border)';
    document.getElementById('pmCard').style.borderColor=method==='card'?'var(--red)':'var(--border)';
    document.querySelector('#pmCrypto .material-symbols-outlined:last-child').textContent=method==='crypto'?'check_circle':'radio_button_unchecked';
    document.querySelector('#pmCrypto .material-symbols-outlined:last-child').style.color=method==='crypto'?'var(--red)':'var(--dim)';
    document.getElementById('pmCardCheck').textContent=method==='card'?'check_circle':'radio_button_unchecked';
    document.getElementById('pmCardCheck').style.color=method==='card'?'var(--red)':'var(--dim)';
}

/* === DEPOSIT FLOW (inside miniapp) === */
function openDepositModal(type){
    if(type==='stars'){
        /* Telegram Stars payment via WebApp invoice */
        var starsPkg=document.querySelector('#starsRow .asset-btn.active');
        var amount=starsPkg?starsPkg.getAttribute('data-stars'):'50';
        buyStars(parseInt(amount));
        return;
    }
    if(payMethod==='crypto'){
        /* CryptoBot payment ‚Äî call backend to create invoice, open URL in browser */
        var pkg=document.querySelector('#assetRow .asset-btn.active');
        var coins=pkg?pkg.getAttribute('data-coins'):'50';
        var price=pkg?pkg.getAttribute('data-price'):'0.50';
        buyCrypto(coins,price);
    }else if(payMethod==='card'){
        /* Card payment ‚Äî call backend to get payment link */
        var pkg2=document.querySelector('#assetRow .asset-btn.active');
        var coins2=pkg2?pkg2.getAttribute('data-coins'):'50';
        var price2=pkg2?pkg2.getAttribute('data-price'):'0.50';
        buyCard(coins2,price2);
    }
}

async function buyStars(amount){
    /* Request invoice link from backend, then open via Telegram WebApp */
    try{
        showToast('‚≠ê',LANG==='ru'?'–°–æ–∑–¥–∞—ë–º —Å—á—ë—Ç...':LANG==='ua'?'–°—Ç–≤–æ—Ä—é—î–º–æ —Ä–∞—Ö—É–Ω–æ–∫...':LANG==='pl'?'Tworzenie faktury...':'Creating invoice...','‚è≥','',null);
        var r=await fetch(API+'/api/create-stars-invoice',{
            method:'POST',headers:{'Content-Type':'application/json'},
            body:JSON.stringify(Object.assign({},auth(),{stars:amount}))
        });
        var d=await r.json();
        closeToast();
        if(d.ok&&d.invoice_link){
            tg.openInvoice(d.invoice_link,function(status){
                if(status==='paid'){
                    showToast('‚úÖ',LANG==='ru'?'–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞! +'+amount+' ‚≠ê':LANG==='ua'?'–û–ø–ª–∞—Ç–∞ –ø—Ä–æ–π—à–ª–∞! +'+amount+' ‚≠ê':LANG==='pl'?'P≈Çatno≈õƒá przesz≈Ça! +'+amount+' ‚≠ê':'Payment successful! +'+amount+' ‚≠ê','OK','',function(){closeToast()});
                    loadBalance();
                }else if(status==='cancelled'){
                    /* User cancelled, do nothing */
                }else if(status==='failed'){
                    showToast('‚ùå',LANG==='ru'?'–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã':LANG==='ua'?'–ü–æ–º–∏–ª–∫–∞ –æ–ø–ª–∞—Ç–∏':LANG==='pl'?'B≈ÇƒÖd p≈Çatno≈õci':'Payment failed','OK','',function(){closeToast()});
                }
            });
        }else{
            showToast('‚ùå',d.error||'Error creating invoice','OK','',function(){closeToast()});
        }
    }catch(e){
        closeToast();
        showToast('‚ùå','Network error','OK','',function(){closeToast()});
    }
}

async function buyCrypto(coins,price){
    try{
        showToast('üíé',LANG==='ru'?'–°–æ–∑–¥–∞—ë–º —Å—á—ë—Ç CryptoBot...':LANG==='ua'?'–°—Ç–≤–æ—Ä—é—î–º–æ —Ä–∞—Ö—É–Ω–æ–∫ CryptoBot...':LANG==='pl'?'Tworzenie faktury CryptoBot...':'Creating CryptoBot invoice...','‚è≥','',null);
        var r=await fetch(API+'/api/create-invoice',{
            method:'POST',headers:{'Content-Type':'application/json'},
            body:JSON.stringify(Object.assign({},auth(),{coins:parseInt(coins),amount:parseFloat(price)}))
        });
        var d=await r.json();
        closeToast();
        if(d.ok&&d.pay_url){
            /* CryptoBot mini_app_invoice_url is a t.me link ‚Äî open inside Telegram */
            var url=d.pay_url;
            if(url.indexOf('t.me/')!==-1){
                tg.openTelegramLink(url);
            }else{
                /* fallback: open inside Telegram's webview */
                tg.openLink(url,{try_instant_view:true});
            }
            pollPayment(d.invoice_id||null);
        }else{
            showToast('‚ùå',d.error||'Error creating invoice','OK','',function(){closeToast()});
        }
    }catch(e){
        closeToast();
        showToast('‚ùå','Network error','OK','',function(){closeToast()});
    }
}

async function buyCard(coins,price){
    try{
        showToast('üí≥',LANG==='ru'?'–°–æ–∑–¥–∞—ë–º –ø–ª–∞—Ç—ë–∂...':LANG==='ua'?'–°—Ç–≤–æ—Ä—é—î–º–æ –ø–ª–∞—Ç—ñ–∂...':LANG==='pl'?'Tworzenie p≈Çatno≈õci...':'Creating payment...','‚è≥','',null);
        var r=await fetch(API+'/api/create-card-payment',{
            method:'POST',headers:{'Content-Type':'application/json'},
            body:JSON.stringify(Object.assign({},auth(),{coins:parseInt(coins),amount:parseFloat(price)}))
        });
        var d=await r.json();
        closeToast();
        if(d.ok&&d.pay_url){
            /* Open card payment inside Telegram webview */
            tg.openLink(d.pay_url,{try_instant_view:true});
            pollPayment(d.invoice_id||null);
        }else{
            var msg=d.error||(LANG==='ru'?'–û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞':LANG==='ua'?'–û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–∫–æ—é —Å–∫–æ—Ä–æ –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∞':LANG==='pl'?'P≈Çatno≈õƒá kartƒÖ wkr√≥tce dostƒôpna':'Card payment coming soon');
            showToast('üí≥',msg,'OK','',function(){closeToast()});
        }
    }catch(e){
        closeToast();
        showToast('‚ùå','Network error','OK','',function(){closeToast()});
    }
}

/* Poll backend for payment completion */
var pollTimer=null;
function pollPayment(invoiceId){
    var attempts=0;
    if(pollTimer)clearInterval(pollTimer);
    pollTimer=setInterval(async function(){
        attempts++;
        if(attempts>60){clearInterval(pollTimer);return} /* stop after 5 min */
        try{
            await loadBalance(); /* reload balance ‚Äî if payment went through, balance will update */
        }catch(e){}
    },5000);
    /* Auto-stop polling after 5 min */
    setTimeout(function(){if(pollTimer)clearInterval(pollTimer)},300000);
}

/* === BALANCE POPUP (header tap) === */
function openBalancePopup(){
    var p=document.getElementById('balPopup');
    p.style.display='block';
    /* Update active state */
    document.getElementById('bpUsdt').classList.toggle('active',activeWallet==='usdt');
    document.getElementById('bpStars').classList.toggle('active',activeWallet==='stars');
    updateBalPopupContent();
    /* Update currency pills */
    document.querySelectorAll('#bpCurrencies .pill').forEach(function(b){
        b.classList.toggle('active',b.getAttribute('data-cur')===displayCurrency);
    });
    document.getElementById('bpCurrencies').style.display=activeWallet==='usdt'?'grid':'none';
    /* Animate in */
    requestAnimationFrame(function(){
        var card=document.getElementById('balPopupCard');
        card.style.transform='translateY(0) scale(1)';card.style.opacity='1';
    });
}
function closeBalancePopup(){
    var card=document.getElementById('balPopupCard');
    card.style.transform='translateY(-8px) scale(.95)';card.style.opacity='0';
    setTimeout(function(){document.getElementById('balPopup').style.display='none'},200);
}
function switchBalPopup(type){
    activeWallet=type;
    document.getElementById('bpUsdt').classList.toggle('active',type==='usdt');
    document.getElementById('bpStars').classList.toggle('active',type==='stars');
    document.getElementById('bpCurrencies').style.display=type==='usdt'?'grid':'none';
    document.getElementById('bpDeposit').textContent=type==='stars'?'BUY STARS':'DEPOSIT';
    updateBalPopupContent();
    updateBalanceUI();
}
function updateBalPopupContent(){
    if(activeWallet==='stars'){
        document.getElementById('bpLabel').textContent='‚≠ê STARS BALANCE';
        document.getElementById('bpAmount').textContent=starsBalance+' ‚≠ê';
        document.getElementById('bpSub').textContent='';
    }else{
        document.getElementById('bpLabel').textContent=displayCurrency+' BALANCE';
        var sym=RATES[displayCurrency]?{USDT:'',USD:'$',PLN:'z≈Ç',UAH:'‚Ç¥',EUR:'‚Ç¨',RUB:'‚ÇΩ',GBP:'¬£'}[displayCurrency]||'':'$';
        document.getElementById('bpAmount').textContent=formatCurrency(usdtBalance);
        document.getElementById('bpSub').textContent=displayCurrency!=='USDT'?'‚âà '+usdtBalance.toFixed(2)+' USDT':'';
    }
}
function setCurrencyPopup(cur){
    setCurrency(cur);
    document.querySelectorAll('#bpCurrencies .pill').forEach(function(b){
        b.classList.toggle('active',b.getAttribute('data-cur')===cur);
    });
    updateBalPopupContent();
}

/* === LANGUAGE SELECTOR (in-app) === */
var LANG_OPTIONS={
    pl:{flag:'üáµüá±',name:'Polski'},
    ua:{flag:'üá∫üá¶',name:'–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞'},
    ru:{flag:'üá∑üá∫',name:'–†—É—Å—Å–∫–∏–π'},
    en:{flag:'üá¨üáß',name:'English'}
};

function openLangSelector(){
    var ol=document.getElementById('langOverlay');
    ol.style.display='flex';
    var list=document.getElementById('langList');
    list.innerHTML=Object.keys(LANG_OPTIONS).map(function(code){
        var l=LANG_OPTIONS[code];
        var isActive=code===LANG;
        return '<button onclick="setLanguage(\''+code+'\')" style="display:flex;align-items:center;gap:12px;padding:14px 16px;border-radius:var(--radius);border:'+(isActive?'1.5px solid var(--red)':'1px solid var(--border)')+';background:'+(isActive?'rgba(227,30,36,.06)':'var(--surface)')+';color:#fff;cursor:pointer;font-family:Inter,sans-serif;font-size:14px;font-weight:600;transition:all .15s">'
            +'<span style="font-size:24px">'+l.flag+'</span>'
            +'<span style="flex:1;text-align:left">'+l.name+'</span>'
            +(isActive?'<span class="material-symbols-outlined" style="color:var(--red);font-size:20px">check_circle</span>':'')
            +'</button>';
    }).join('');
    ol.onclick=function(e){if(e.target===ol)ol.style.display='none'};
}

function setLanguage(code){
    /* Save via API and reload */
    fetch(API+'/api/set-language',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(Object.assign({},auth(),{language:code}))})
    .then(function(){
        /* Reload page with new lang */
        var params=new URLSearchParams(location.search);
        params.set('lang',code);
        location.search=params.toString();
    }).catch(function(){
        var params=new URLSearchParams(location.search);
        params.set('lang',code);
        location.search=params.toString();
    });
}

function initLangDisplay(){
    var cur=LANG_OPTIONS[LANG];
    var el=document.getElementById('profLangCurrent');
    if(el&&cur)el.textContent=cur.flag+' '+cur.name;
    var el2=document.getElementById('profLang');
    if(el2)el2.textContent=LANG==='ru'?'–Ø–∑—ã–∫':LANG==='ua'?'–ú–æ–≤–∞':LANG==='pl'?'Jƒôzyk':'Language';
}

/* === INIT === */
initLocale();
initLangDisplay();
buildCategories();
buildGameGrid();
initBonuses();
buildWalletPackages();
loadBalance();
checkWheel();
loadReferral();
</script>
</body>
</html>
